\documentclass[12pt, a4paper]{report}
\usepackage{amsmath,amsfonts,amsthm,amssymb,color}
\usepackage{dsfont,tikz-cd,minitoc,pifont,tabu,enumerate,lipsum}
\usepackage[style=alphabetic]{biblatex}

\addbibresource{references.bib}
\usepackage[nottoc]{tocbibind}

\usepackage{hyperref}

\topmargin 0cm
\headheight 0cm
\oddsidemargin 0cm
\evensidemargin 0cm
\headsep 1.0cm
\footskip 1.0cm
\textwidth 16cm
\textheight 24cm

\begin{document}

% Latex template
%%%%%%%%%%%%%%%%%%%%%%%%% preamble

% theorem-type environments
\theoremstyle{plain}
\newtheorem{prop}{Proposition}[subsection]
\newtheorem{thm}[prop]{Theorem}
\newtheorem*{thm*}{Theorem}
\newtheorem{cor}[prop]{Corollary}
\newtheorem{lemma}[prop]{Lemma}
\newtheorem{conj}[prop]{Conjecture}

\theoremstyle{definition}
\newtheorem{example}[prop]{Example}
\newtheorem{defn}[prop]{Definition}

\theoremstyle{remark}
\newtheorem{remark}[prop]{Remark}

\numberwithin{equation}{subsection}

% user-defomed macros
\newcommand{\defin}{\textbf}
\newcommand{\CC}{{\mathbb C}}
\newcommand{\cov}{{\operatorname{cov}}}
\newcommand{\eE}{{\mathcal E}}
\newcommand{\NN}{{\mathbb N}}
\newcommand{\PP}{{\mathbb P}}
\newcommand{\ZZ}{{\mathbb Z}}
\renewcommand{\SS}{{\mathbb S}}
\newcommand{\DD}{{\mathbb D}}
\newcommand{\RR}{{\mathbb R}}
\newcommand{\QQ}{{\mathbb Q}}
\newcommand{\rR}{{\mathcal R}}
\newcommand{\OO}{{\mathcal O}}
\newcommand{\p}{\partial}
\newcommand{\mM}{{\mathcal M}}
\newcommand{\pP}{{\mathcal P}}
\newcommand{\iI}{{\mathcal I}}
\newcommand{\jJ}{{\mathcal J}}
\newcommand{\uU}{{\mathcal U}}
\newcommand{\sS}{{\mathfrak S}}
\newcommand{\1}{{\mathds 1}}
\newcommand{\Crit}{\operatorname{Crit}}
\newcommand{\GKK}{{G_{\bar{K} : K}}}
\newcommand{\st}{{\text{s.t.}}}
\newcommand{\ra}{\rightarrow}
\newcommand{\Sel}{\text{\normalfont Sel}}
\newcommand{\Sha}{\text{\normalfont Sha}}
\newcommand{\TS}{\text{\normalfont TS}}
\newcommand{\Eb}{\bar{E}}
\newcommand{\EQ}{E(\QQ)}
\newcommand{\cmark}{\textrm{\ding{51}}}
\newcommand{\xmark}{\textrm{\ding{55}}}
\newcommand{\EFp}{{\tilde{E}(\FF_p)}}
\newcommand{\EFt}{{\tilde{E}(\FF_2)}}
\newcommand{\EQp}{{E(\QQ_p)}}
\newcommand{\FF}{\mathbb{F}}
\newcommand{\HH}{\mathbb{H}}
\newcommand{\Tors}{{\text{\normalfont Tors}}}
\newcommand{\parder}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\Zpx}{\mathbb{Z}_p^\times}
\newcommand{\legendre}[2]{\left(\frac{#1}{#2}\right)}
\newcommand{\quadring}[1]{\ZZ[\sqrt{#1}]}
\newcommand{\Ip}{\mathfrak{p}}
\newcommand{\Aa}{\mathbb{A}}
\newcommand{\LL}{\mathcal{L}}
\newcommand{\Shim}{\textnormal{Shim}}

% colours
\definecolor{red}{rgb}{1,0,0}
\newcommand{\red}[1]{{\color{red}#1}}


\begin{titlepage}
	\centering
	{\scshape\large university college london \par}
	\vspace{1cm}
	{\scshape\large master's project \par}
	\vspace{1.5cm}
	{\huge\bfseries verifying some consequences of the birch swinnerton-dyer
    conjecture \par}
	\vspace{2cm}
	{\large\itshape felipe jacob\par}
	\vfill
	supervised by\par
	dr richard hill \textsc{ucl}

	\vfill

% bottom of the page
	{\large \today\par}
\end{titlepage}


\tableofcontents
\pagebreak


\chapter{Introduction}

In this project we will investigate some of the deep techniques employed in
working out the rank of an elliptic curve. In particular, we will consider the
problem of finding the rank of the curves given by
\[E_n(\QQ) : y^2 = x^3 - n^2 x,\]
where $n$ is odd and squarefree.

To do this we will pursue two different chains of ideas:
\begin{enumerate}
\item The famous Birch Swinnerton Dyer conjecture relates many invariants of an
  elliptic curve to a complex analytic object called the Hasse-Weil L-function.
  We intend to provide a self-contained explanation of all the quantities that occur
  in the BSD conjecture, and how they relate to the arithmetic properties of the
  curve. Once the theoretical ground is laid, we will calculate all these
  invariants for the curves $E_n$.
  This will require a variety of methods, ranging from p-adic numbers to
  Galois Cohomology.
\item The theory of modular forms provides techniques to deal with L-functions at
  a Fourier analytic level. In particular, Tunnell's theorem takes advantage of
  the fact that $L(E_n,s)$ are given by twists of $L(E_1,s)$ by a quadratic
  character to give
  very concise way of describing the
  critical values $L(E_n,1).$
  We intend to give an overview of the chain of results that imply Tunnell's theorem.
\end{enumerate}

Finally, we will see that Tunnell's theorem, together with the Birch Swinnerton-Dyer
conjecture, predicts that
\begin{equation} \label{eq:prediction}
  a_n^2 = \# \Sha(E_n) \cdot R_{E_n} \cdot 4^{\omega(n)} \cdot 0^r
\end{equation}
where the $a_n$ are certain integers associated to the Hasse-Weil L-function
$L(E_n,s)$, $r$ is the rank of $E_n$,
$\Sha(E_n)$ is the Tate-Shafarevich group,
$R_{E_n}$ is the Regulator and $\omega(n)$ is the number of prime factors of
$n$. All these quantities will be defined in due time. 

The calculations in this project will allow us to prove (see \autoref{mainthm1}): 
\begin{thm*}
  Let $n$ be odd and squarefree. If $\Sha(E_n)$ is finite, we have
  \[a^2_n \equiv \# \Sha(E_n) \cdot R_{E_n} \cdot 4^{\omega(n)} \cdot 0^r \mod{16}.\]
  Furthermore, if $n \equiv 3 \, (8)$, this holds modulo 32.
\end{thm*}
In the (unlikely) possibility that $\Sha(E_n)$ is infinite, we also formulate
and prove weaker statements. Namely, we can interpret the existence of 2-torsion in
$\Sha(E_n)$ as saying that \autoref{eq:prediction} holds modulo 8.


\chapter{Elliptic Curve Invariants and the BSD Conjecture}

One of the major topics in modern number theory is the study of rational
solutions to cubic equations in two variables, called elliptic curves.
In this project we will
investigate the relationships between the arithmetic invariants of such
equations and certain analytic functions. Such relationships give rise to
many conjectures with powerful implications, a few of which we will discuss.
We will first define the objects of interest and their invariants, and then
continue with the main calculations.

\section{Basic definitions and the group law}

\begin{defn}
  If $K$ is a field,
  we say an \defin{elliptic curve} over $K$ is a smooth cubic projective
  curve $E$ defined over $K$ with at least one rational point $\OO \in E(K)$
  that we call the \defin{point at infinity}.
\end{defn}
With the help of algebraic geometry, we know that such curves can be put
into particularly simple forms.

\begin{prop}
  If $E$ is an elliptic curve over $K$, then it is birationally equivalent
  to the projective completion of the curve
  \begin{equation} \label{eq:weier2}
    E: y^2 + a_1xy + a_3y = x^3 + a_2x^2 + a_4x + a_6
  \end{equation}
  with $a_1, a_2, a_3, a_4, a_6 \in K.$
  Furthermore, when $\text{char}(K) \neq 2$ (such as when $K$ is a number field)
  , the affine variety also can be written as the locus of
  \begin{equation} \label{eq:weier}
    E: y^2 = x^3 + ax^2 + bx + c
  \end{equation}
  with $a, b, c\in K$. This equivalence also takes the rational point $\OO$ to
  $(0 : 1 : 0)$.
  Conversely, an equation of the form \ref{eq:weier} is an elliptic curve if
  \[\Delta(E) = -4a^3c + a^2b^2 + 18abc - 4b^3 - 27c^2 \neq 0,\]
  i.e. if the RHS cubic has no repeated roots.
\end{prop}

\begin{proof}
  \cite[See][Chapter III, pages 42-43]{arithmetic}.
\end{proof}

Henceforth we will only consider elliptic curves $E(K)$
given by the affine model in \autoref{eq:weier}. The
point $\OO$ will always correspond to the point $(0:1:0)$ in the projective
completion of $\Aa^2(K).$
We will usually take $K = \QQ$, unless otherwise specified.

In this project we will be particularly interested in the following family
of elliptic curves

\begin{defn}
  The family of \defin{quadratic twists of the curve $E_1 : y^2 = x^3 - x$}
  is the family of curves
  \begin{equation} \label{eq:twist}
    E_n : y^2 = x^3 - n^2 x
  \end{equation}
  where $n$ is a positive integer.
\end{defn}

We will only be interested in the case where $n$ is odd and squarefree. Such
curves have a long history going back to Fermat, and are notorious for their
appearance in the problem of finding right triangles with rational sides and a
given area. See \cite{koblitz} for a lot more on this story.

Elliptic curves are of particular interest primarily because, besides being
a variety, they also form an abelian group. To build the group, we take the
affine model in 
\autoref{eq:weier} and define a geometric way to combine two points of $E$. This
will turn out to behave like a group law.

Given two distinct points $P_1, P_2 \in E(K)$, let $P_1 * P_2$ be the third point
which intersects both $E$ and the projective line between $P_1$ and $P_2$. 
If $P_1 = P_2 \in E(K)$, let $P_1 * P_2$ be the other point of $E(K)$ which
meets the line tangent to $E(K)$ at $P_1.$

In both cases the operation $*$ is well defined,
since finding the coordinates of $P_1 * P_2$ amounts to solving
a cubic equation with coefficients in $K$ and 2 known roots.
Finally, we set
\[P_1 + P_2 = (x_3, -y_3) \text{ where } (x_3,y_3) = P_1 * P_2.\]
The verification that the operation $+$ is indeed a group law involves either
extensive case checking or
some complex analysis, which we will not go into, but see
\cite[129-137]{Granville} for a sketch.

A few explicit formulas for the addition law that we will use throughout the project
are given in the next proposition. 

\begin{prop}
  If $P_1 = (x_1,y_1), P_2 = (x_2,y_2) \in E$ with neither being the point at
  infinity, and $P_1 \neq P_2$, let
  $$\lambda = \frac{y_1-y_2}{x_1-x_2}.$$
  Then we have
  \[P_1 + P_2 = (x_3,-y_3)\]
  where
  \begin{equation} \label{eq:adddiff}
    \begin{split}
      x_3 &= \lambda^2 - a - x_1 - x_2 \\
      y_3 &= \lambda x_3 + (y_1 - \lambda x_1).
    \end{split}
  \end{equation}

  If instead $P_1 = P_2,$ let
  \[\lambda = \frac{3x_1^2 + 2ax_1 + b}{2y_1}.\]
  We similarly have
  \[P_1 + P_2 = (x_3,-y_3)\]
  where
  \begin{equation} \label {eq:addsim}
    \begin{split}
      x_3 &= \lambda^2 - a - 2x_1 \\
      y_3 &= \lambda x_3 + (y_1 - \lambda x_1).
    \end{split}
  \end{equation}
\end{prop}
\begin{proof}
  \cite[See][Chapter 1.7, page 34]{koblitz}.
\end{proof}

The following results about $\EQ$ were discussed in the course MATH3705,
and their proofs can be found in \cite{rational}, chapters II and III for the
case where \autoref{eq:weier} has at least 1 rational root.

\begin{thm}[Mordell-Weil Theorem]
  The group $\EQ$ is a finitely generated abelian group.
\end{thm}  
\begin{proof}
  \cite[See][Chapter III, pages 63-88]{rational}. Also see the discussion in
  \autoref{sec:applications}.
\end{proof}

By the classification theorem of finitely generated abelian groups, covered in
MATH3201, we can write
\begin{equation} \label{rankdefn}
\EQ = \Tors(\EQ) \times \ZZ^r
\end{equation}
for some natural number $r$. The subgroup $\Tors(\EQ)$ is the (finite) set of
points of finite order in $\EQ$, called the \defin{torsion points of $\EQ$}.

\begin{defn}
  The number $r$ occuring in \autoref{rankdefn} is called the
  \defin{rank of $E(\QQ)$}. Finding $r$ for an arbitrary $E$ is one of the main
  problems in the theory of Elliptic Curves.
\end{defn}

\begin{thm}[Nagell-Lutz Theorem] \label{thm:nagelllutz}
  Let
  \[E: y^2 = f(x) = x^3 + ax + b\]
  be an elliptic curve over $\QQ$, and let $\Delta = -4a^3 -27b^2$ be the
  polynomial discriminant of $f(x)$. If $P = (x,y)$ is a point of finite order,
  then either $y = 0$, in which case $P$ has order 2, or we must have $y^2 \mid \Delta$.
\end{thm}
\begin{proof}
  \cite[See][Chapter II, pages 49-56]{rational}.
\end{proof}

For the curves $E_n$, it turns out that the only torsion points are the obvious
ones of order 2.

\begin{prop} \label{proof:torsion}
  The curve $E_n(\QQ)$ has 4 torsion points, and
  \[E_n(\QQ)_{\textnormal{tors}} = \{\OO, (0,0), (n,0), (-n,0)\}.\]
\end{prop}

\begin{proof}
  \cite[See][Chapter I-9, pages 44-45]{koblitz}.
\end{proof}

\section{Local Zeta Functions}

One of the most powerful tools in all of discrete mathematics is the passing
from sequences of combinatorial magnitudes $\{a_n\}$ to a formal power series
\[f(z) = \sum\limits_{n=0}^\infty a_nz^n\]
called the \defin{generating function} of $\{a_n\}.$ This formal power series
encapsulates the whole sequence into a single object. By letting $z \in \CC$,
we can hope the
resulting analytic properties of $f$ as a holomorphic function can be translated
back to information about the coefficients $a_n$.

One of the main advantages to
this approach is that multiplication of different generating functions acts in
a combinatorially meaningful way on the coefficients of their product via a
convolution
\[\sum\limits_{n=0}^\infty a_n z^n \cdot \sum_{n=0}^\infty b_n z^n =
\sum\limits_{n=0}^\infty \left( \sum\limits_{s+t = n} a_sb_t \right)z^n.\]
We can use this fact to construct more complicated series from
simpler ones, and use this construction to simplify our analysis.

In number theory, the generating function of choice usually takes a different
form called the \defin{Dirichlet series of $\{a_n\}$}
\[f(s) = \sum\limits_{n=1}^\infty\frac{a_n}{n^s}, \,\, s \in \CC. \]
This is useful to us since the convolution now takes a multiplicative form
\[\sum\limits_{n=1}^\infty\frac{a_n}{n^s} \cdot
  \sum\limits_{n=1}^\infty\frac{b_n}{n^s} =
  \sum\limits_{n=1}^\infty \left( \sum\limits_{s \cdot t = n} a_sb_t \right) n^{-s}\]
which translates better the combination of sequences that appear in number
theory. What we have is a situation in which all
objects of size $n$ are obtained by stitching together $s$ objects of size $t$,
where $s$ and $t$ are some divisors of $n$.
For a few neat elementary applications of this principle, see \cite[Section 2.6, pages 59-68]{wilf}.

\begin{example}
  The \defin{Riemann Zeta Function} is the Dirichlet series of
  $\{1\}_{n=1}^\infty$ given by
  \[\zeta(s) = \sum\limits_{n=1} \frac{1}{n^s},\]
  and takes a prominent role in analytic number theory.
  As a consequence of uniqueness of factorization in $\ZZ$, we can also write
  \[\zeta(s) = \prod\limits_{p \text{ prime}}\left( 1-p^{-s} \right)^{-1}.\]
  This is called the \defin{Euler product} of $\zeta.$
\end{example}

\begin{example}
  Let $d_k(n)$ be the number of ordered ways of writing $n$ as a product of $k$
  factors. Then we can write
  \[d_k(n) = \sum\limits_{a_1 a_2 \cdots a_k = n} 1.\]
  Using the convolution formula, we get that
  \[\sum\limits_{n=1}^\infty \frac{d_k(n)}{n^s} = \zeta^k(s),\]
  so analytic information about $\zeta$ can be used to study the growth of
  $d_k(n).$
\end{example}

We can generalise generating functions further by changing the denominator of
the Dirichlet series. 

\begin{example}
  Let $K : \QQ$ be a number field and let $\OO_K$ be the ring of algebraic
  integers of $K$.
  The \defin{Dedekind-Zeta function of $K$} is
  a series given by 
  \[\zeta(K,s) = \sum\limits_{I \triangleleft \, \OO_K} \frac{1}{||I||^s} \]
  where the sum ranges over all nonzero ideals of $\OO_K$.
  Since $\OO_K$ is a Dedekind domain, it has the property of unique
  factorization of ideals, so we can also write the Euler product
  \[\prod\limits_P \left( 1-||P||^{-s} \right)^{-1}.\]
  Here $P$ ranges over the maximal ideals of $\OO_K$. 
\end{example}

The importance of this example is that now the convolution is no longer
multiplicative in $\ZZ$, but in the ideals $I$ of $\OO_K$. This allows us to
consider arithmetic sequences that combine multiplicatively on larger
number fields.

\begin{example} \label{dedekind_example}
  Let $K = \QQ(\sqrt{-2})$, so that $\OO_K = \quadring{-2}$. 
  Later we will find a simple formula for the coefficient of $n^{-s}$ of
  $\zeta(K,s)$ when $n$ is odd and squarefree.

  We can also
  define a function $d_k(K,n)$ which counts the number of ways of writing an
  ideal of norm $n$ as a product of $k$ ideals in $\OO_k$, i.e. the number of
  $k$-tuples $P_1, \dots, P_k$ such that $||P_1 \cdots P_k||_{\OO_K} = n.$
  From the convolution rule for number fields, we get
  \[\sum\limits_{I \triangleleft \OO_K} = \frac{d_k(K,||I||)}{||I||^s} =
  \zeta^k(K,s).\]
Thus, we can try to understand factorization of ideals in $\OO_K$ from
the analytic properties of $\zeta^k(\quadring{-2}, s).$
\end{example}

The zeta functions we are going to be most interested in will help us capture
the behaviour of an elliptic curve $E(K)$ locally, i.e. when $K = \FF_p$.

Let $p$ be an odd prime and $\FF_p$ be the unique field of $p$ elements. We say
that a polynomial $f \in \FF_p[x,y]$ is \defin{absolutely irreducible} if it is
irredubicle in the algebraic closure $\overline{\FF}_p[x,y].$

\begin{prop}
  Let $f \in \FF_p[x,y]$ be absolutely irreducible, and assume the variety
  $V_f(\overline{\FF}_p)$ is nonsingular. Then the coordinate ring
  \[C_f = \frac{\FF_q[x,y]}{(f)}\]
  is a Dedekind domain with finite quotients. In particular, it has the property
  of unique factorization of ideals.
\end{prop}
\begin{proof}
  \cite[See][Corollary 2.7, page 229]{lorenzini}.
\end{proof}

Inspired by our previous examples, we can define a zeta function for $V_f$. Let
\[\zeta(V_f, \FF_p, s) = \sum\limits_{I \triangleleft \, C_f} \frac{1}{||I||^s}
\]
where the sum is over all ideals of $C_f$. Here the norm $||I||$ is defined to
be the number of elements in $C_f / I$. Since $C_f$ has unique factorization
of ideals, we also get a Euler product 
\[\zeta(V_f, \FF_p, s) = \prod\limits_{M \in \text{Max}(C_f)} \left( 1 - ||M||^{-s} \right)^{-1}\]
where $\text{Max}(C_f)$ is the set of maximal ideals of $C_f$.
If we let
\[b_k = \# \{M \in \text{Max}(C_f) \, ; \, |C_f/M : \FF_p| = k\},\]
then by definition $||M|| = |C_f/M| = p^k$, so we get
\[\zeta(V_f, \FF_p, s) = \prod\limits_{n=1}^\infty (1 - q^{-sn})^{-b_n}.\]

Now let $z = p^{-s}$ and let $Z(z) = \zeta(V_f, \FF_p, s)$. Taking logarithms
we ge
\begin{equation*}
  \begin{split}
    \log (Z(z)) &= - \sum\limits_{n=1}^\infty b_n \log(1-z^d) \\
    &= \sum\limits_{n=1}^\infty \left( \sum\limits_{k=1}^\infty \frac{z^{nk}}{k} \right) \\
    &= \sum\limits_{n=1}^\infty \big( \sum\limits_{k \mid n} kb_k \big) \frac{z^n}{n} .
  \end{split}
\end{equation*}

\begin{prop}
  We have
  \[\sum\limits_{k \mid n} kb_k = \# V_f(\FF_{p^r})\]
  where $\# V_f(\FF_{p^n})$ is the number of roots of $f$ in the unique field of
  $p^n$ elements.
\end{prop}
\begin{proof}
  \cite[See][Proposition VII-3.5, page 232]{lorenzini}.
\end{proof}

The above remarks motivate the following definition:

\begin{defn}
  Let $V$ be a variety over $\FF_p$.
  The \defin{local zeta function of $V$ at $p$} is the formal power series
  \begin{equation} \label{zeta_defn}
    Z(V, p, z) = \exp \left( \sum\limits_{r=1}^{\infty} \# V(\FF_{p^r}) \frac{z^r}{r} \right)
  \end{equation}
  where $\# V(\FF_{p^r})$ is the number of points of $V$ in the (unique) field
  of $p^r$ elements.
\end{defn}

\begin{example}[Point]
  If $V = (x_0:y_0:z_0)$ is a point, then $\#V(\FF_{p^r}) = 1$, so
  \begin{equation*}
    \begin{split}
      Z(V,p,z) &= \exp \left( \sum\limits_{r=1}^{\infty} \frac{z^r}{r} \right) \\
               &= \exp (-\log (1-z)) \\
               &= \frac{1}{1-z}.
    \end{split}
  \end{equation*}
             
\end{example}

\begin{example}[Affine Space]
  If $V = \mathbb{A}^n$ is the affine
  $n$-space $, \#\Aa^n(\FF_{p^r}) = p^{rn}$, so
  \begin{equation*}
    \begin{split}
      Z(\mathbb{A}^n) &= \exp \left(  \sum\limits_{r=1}^\infty \frac{(pz)^r}{r} \right) \\
      &= \exp ( - \log (1-p^nz) ) \\
      &= \frac{1}{1-p^nz}
    \end{split}
  \end{equation*}
\end{example}

\begin{example}[Projective Space]
  If $V = \mathbb{P}^n$ is the projective $n$-space,
  then $\# \PP^n(\FF_{p^r})  
  = 1 + p^r + \cdots + p^{nr}$. So

  \begin{equation*}
    \begin{split}
      Z(\mathbb{\PP}^n) &= \exp \left(  \sum\limits_{r=1}^\infty
        \sum\limits_{s=0}^{n} \left(  \frac{z^r}{r}  \right) \right) \\
      &= - \sum\limits_{s=0}^{n} \log (1 - p^n z) \\
      &= \frac{1}{(1-z) (1-pz) \cdots (1-p^{n} z)}
    \end{split}
  \end{equation*}
\end{example}

We note, in tandem with our philosophy of generating functions and convolutions,
the expression
\[Z(\PP^n) = Z(\Aa^0) \times Z(\Aa^1) \times \cdots \times Z(\Aa^n)\]
beautifully mimics the geometric construction of $\PP^n$ from a point, attaching
one cell of each dimension. 

Turning to the curves in our family $E_n$, we will show later
(see \autoref{singularity_condition})
that $E_n$ is nonsingular at $p$ if and only if $p \nmid 2n$. This will affect
the form of its local zeta function.

At the primes where it has bad reduction, $Z(E_n,p,z)$ is identical to the zeta
function of a projective line:

\begin{prop}
  If $p \mid 2n$, then
  \[Z(E_n, p, z) = \frac{1}{(1-z)(1-pz)}.\]
\end{prop}

\begin{proof}
  There are two cases to consider.
  \begin{itemize}
  \item If $p = 2$, the affine equation takes the form
    \[E_2: y^2 = x^3 + x,\] with the single point at infinity $(0:1:0).$

    But in $\FF_{2^r}$, the map $x \mapsto x^2$ is injective since
    \[x^2 = y^2 \implies x^2-y^2 = (x-y)^2 = 0 \implies x = y,\] where the
    middle equality follows from characteristic 2. Since
    $\FF_{2^r}$ is finite, the squaring map must also be surjective, so all
    elements have unique square roots. Thus,
    \[\# E_n(\FF_{2^k}) = 1 + \# \FF_{2^k} = 1 + 2^{k},\] and
    \begin{equation*}
      \begin{split}
        Z(E_n,2,z) &= \exp \left( \sum\limits_{r=1}^\infty (1 + 2^r)\frac{z^r}{r}
                     \right) \\
                   &= \exp \left( \sum\limits_{r=1}^\infty \frac{z^r}{r} \right) 
                     \exp \left( \sum\limits_{r=1}^\infty \frac{(2z)^r}{r} \right) \\
                   &= \frac{1}{(1-z)(1-2z)}.
      \end{split}
    \end{equation*}
  \item If $p \mid n$, the equation of the curve becomes
    \[E_p: y^2 = x^3,\]
    again with a single point at infinity $(0:1:0)$.

    Since $p$ is odd, each element in $\FF_{p^r}$ has either 0 or 2 square
    roots. Let $\chi$ be the quadratic character in $\FF_{p^r}$. Then
    \begin{equation*}
      \begin{split}
        \# E_n(\FF_{p^r}) &= 1 + \sum\limits_{x \in \FF_{p^r}}
        \left( 1 + \chi(x^3) \right) = 1 + p^r + \sum\limits_{x \in \FF_{p^r}}
                            \chi(x)  \\
                          &= 1 + p^r.
      \end{split}
    \end{equation*}
    The last sum is 0 since there are as many quadratic residues as quadratic
    non-residues in $\FF_{p^r}.$ 
    Thus, again we get
    \begin{equation*}
      \begin{split}
        Z(E_n, p, z) &= \exp \left(\sum\limits_{r=1}^\infty (1+p^r) \frac{z^r}{r}\right) \\
                     &= \frac{1}{(1-z)(1-pz)}.
      \end{split}
    \end{equation*} \qedhere
    
  \end{itemize}
  
  
\end{proof}

For the primes where $E_n$ has good reduction, \autoref{zeta_defn} takes
the form of a quadratic rational function in $z$:

\begin{prop} \label{zeta_elliptic}
  If $p \nmid 2n$, then
  \[Z(E_n, p, z) = \frac{1 - 2a_pz + pz^2}{(1-z)(1-pz)} \]
  where $a_p = \Re(\alpha)$, and $\alpha$ is the complex number
  $i\sqrt{p}$ if $p \equiv 3 \, (4)$ or an element of $\ZZ[i]$ of
  norm $p$ congruent to $(\frac{n}{p})$ modulo $2+2i$ if $p \equiv 1 \, (4)$. 
\end{prop}

\begin{proof}
  \cite[See][Chater II-2, pages 59-61]{koblitz}.
\end{proof}



\section{The Hasse-Weil L-function}

The last step in this chain of generalisations is to let the prime $p$ vary.
Following the
philosophy of convolutions, it is natural to consider the product
\[\prod\limits_{p} Z(V, p, z_p),\]
over all primes numbers,
which incorporates information about the variety $V$ in all possible finite
fields. Making the change of variables $z_p = p^{-s}$, we arrive at the next definition.

\begin{defn}
  The \defin{Hasse-Weil L-function of $V$} is the function
  \[L(V,s) = \prod \limits_p Z(V,p,p^{-s})\]
  where the product is over all prime numbers $p$.
\end{defn}

\begin{example}
  If $V$ is a point, we saw that
  \[Z(V,p,z) = \frac{1}{1-z},\]
  so
  \[L(V,s) = \prod\limits_p Z(V,p,p^{-s}) = \prod\limits_p \frac{1}{1-p^{-s}} = \zeta(s)\]
  is the familiar Riemann-Zeta function.
\end{example}

\begin{example}
  If $V = \PP^n$ is the projective $n$-space, we saw that
  \[Z(\PP^n,p,z) = \frac{1}{(1-z)(1-pz) \cdots (1-p^nz)},\]
  so
  \[
    \begin{split}
      L(\PP^n,s) &= \prod\limits_p \frac{1}{(1-p^{-s})(1-p^{1-s}) \cdots
        (1-p^{n-s})} \\
      &= \zeta(s) \zeta(1-s) \cdots \zeta(n-s).
    \end{split}
\]
\end{example}

For the elliptic curves $E_n$, the local zeta function at $p$ may take two possible forms
depending on wether $\Delta(E_n)$ is a multiple of $p$. Putting both results
together gives
\[
  \begin{split}
    \prod\limits_{p} Z(E_n, p, p^{-s}) &= \prod\limits_{p \nmid 2n}
    \frac{1-2a_pp^{-s} + p^{2-s}}{(1-p^{-s})(1-p^{1-s})} \cdot \prod\limits_{p \mid
      2n} \frac{1}{(1-p^{-s})(1-p^{1-s})} \\  &=\zeta(s) \zeta(s-1) \prod\limits_{p
      \nmid 2n} (1 - 2a_pp^{-s} + p^{2-s})
  \end{split}
\]
where we spotted the Euler product of the Riemann-Zeta function in the
denominators. The $a_p$ are the real numbers obtained on
Proposition \autoref{zeta_elliptic}.

Taking the reciprocal and clearing off the Riemann-Zeta factors, we arrive at
the next definition.

\begin{defn}
  The \defin{Hasse-Weil L-function} of $E_n$ is written
  \begin{equation} \label{eq:lfunction}
    L(E_n, s) = \frac{\zeta(s) \zeta(s-1)}{\prod_{p \nmid 2n} Z(E, p, p^{-s})}
    = \prod\limits_{p \nmid 2n} \frac{1}{1-a_pp^{-s} + p^{1-2s}}.
  \end{equation}
\end{defn}

It is this function that will play the main role in the statement of the Birch
Swinnerton-Dyer conjecture. The usefulness of considering L-functions comes not
so much in analyzing a single curve, but in understanding the behaviour of
certain families of curves which have similar L-functions.

In the case of our family $E_n$, let
\[L(E_1,s) = \sum\limits_{m=1}^\infty \frac{a_m}{m^s}\]
be the Dirichlet series corresponding to $L(E_1,s)$. Then, it turns out
(\cite[See][Pages 80-81]{koblitz}) that
$L(E_n,s)$ has the related Dirichlet series
\[L(E_n,s) = \sum_{m=1}^\infty \chi_n(m) \frac{a_m}{m^s}. \]
where $\chi_n(m)$ is the Jacobi symbol
$\legendre{n}{m}$ with the exception that we let $\chi_n(2) = 0.$

Thus, the series for $L(E_n,s)$ is what is called a \defin{twist of $L(E_1,s)$
by the character $\chi_n$}. This justifies we calling
the curves $E_n$ the family of quadratic twists of $E_1$.

\section{The Regulator}

Going back to considering elliptic curves, the next invariant measures the
rate of growth of the complexity of points as we take higher and higher
multiples of a fixed point. We first need a few definitions.

\begin{defn}
  Let $P = (\frac{a}{b},y) \in E(\QQ), (a,b) = 1$. The \defin{height of $P$} is
  defined to be the number
  \[ H(P) = \max \{|a|, |b| \}.\]
\end{defn}

It turns out that taking an integer multiple of a point of $E$ has an
exponential effect on its height, so we prefer to work with the logarithmic
height $h(P) = \log (H(P))$. To better yet capture the now almost linear
behaviour of $h(P)$, we define

\begin{defn}[Neron-Tate height]
  Let $P \in E(\QQ)$. Then the \defin{Neron-Tate height of $P$} is defined to be
  \[ \hat{h}(P) = \lim\limits_{n \rightarrow \infty} \frac{\log H(2^n P)}{4^n}. \]
\end{defn}

It turns out that the Neron-Tate height enables us to define an inner product
on $\EQ$.

\begin{defn}[Neron-Tate pairing]
  Let $P, Q \in \EQ$. Then the pairing
  \[ \langle P,Q \rangle =
    \frac{1}{2} \left( \hat{h}(P+Q) - \hat{h}(P) - \hat{h}(Q) \right)\]
  is an inner product on $\EQ$ called the \defin{Neron-Tate pairing}.
\end{defn}

We will use the Neron-Tate pairing to define an invariant that plays a role
similar to that of the determinant of a linear map in measuring the size of
the image of the unit cube.

\begin{defn}[Regulator]
  Let $P_1, \dots P_r$ be a basis for $\frac{{\EQ}}{\Tors (E)}$.
  Then the \defin{regulator of $\EQ$} is the number
  \[R_E = \det ( \langle P_i, P_j \rangle)_{1\leq i, j \leq r}.\]
\end{defn}

The importance of the regulator is justified by the following proposition

\begin{prop}
  Let $r$ be the rank of $\EQ$.

  If $r = 0$ then $\# \EQ = \# \Tors(E)$.

  If $r \geq 1$ then, as $x \rightarrow \infty$,
  \[\# \{P \in \EQ \, | \, \hat{h}(P) \leq x \} \approx \frac{\#
      \Tors(E)}{R_E^{1/2}}
    B_r x^{r/2}\]
  where $B_r$ is the volume of the $r$-dimensional unit ball.
\end{prop}
\begin{proof}
  \cite[See][Chapter 13.7, page 127]{Granville}.
\end{proof}
  

\begin{remark}
  To check that all definitions given in this section behave precisely as
  stated, see \cite[Chapter 13.7-8, pages 123-127]{Granville}.
\end{remark}
  

\section{The Real Period and Sha}

Before we are ready to state the main conjecture, we need to define a few
other invariants of $E$. 

\begin{defn}[Real Period] \label{proof:real_period}
  The \defin{real period of $E$} is defined to be the real number
  \[\Omega_E = \int_{E(\RR)} \frac{dx}{2y}.\]

  For the family $E_n$ of quadratic twists of $E_1$, it turns out that
  \[\Omega_{E_n} = \frac{1}{\sqrt{n}} \, \Omega_{E_1} = \frac{2}{\sqrt{n}}
    \int_1^\infty \frac{dx}{\sqrt{x^3-x}}.\]
  The last integral cannot be evaluated in terms of elementary functions, but
  its value is a real number $\beta \approx 2.622$.
\end{defn}

The next invariant that will appear in the BSD conjecture is the
\defin{Tate Shafarevich group $\Sha(E)$}, which will
be defined in \autoref{defn:sha}. It is an abelian group which intuitively measures
the hardness of working out the rank of $E(\QQ)$ by local methods, and is conjectured
to be finite.

\section{Tamagawa Numbers}

Note that the local zeta function of $E$ gives us essentially no
information to \autoref{eq:lfunction} at the primes where the curve is singular.
The arithmetic data at those
primes enters the BSD conjecture by means of the Tamagawa
Numbers. 
Let
$$ E : y^2 = f(x) = x^3 + ax^2 + bx + c $$
be an elliptic curve $\QQ$ with coefficients $a,b,c \in \ZZ.$

If $p$ is not a factor of $\Delta(E)$, the discriminant of the cubic polynomial
$f(x)$,
then the reduction
$\tilde{E} : y^2 \equiv x^3 +ax^2 + b x + c \, (p)$ is
also an elliptic curve over $\FF_p$. The group $E(\FF_p)$ turns out to be
closely related to $E(\QQ).$

\begin{prop}[Reduction Modulo p]
  If $p $ is not a factor of $ \Delta(E)$, the reduction map
  $$E(\QQ) \rightarrow \tilde{E}(\FF_p)$$ is a group homomorphism.
\end{prop}
\begin{proof}
  \cite[See][Chapter IV, pages 121-123]{rational}.
\end{proof}

If $p $ is a factor of $\Delta E$ then $\tilde{E}(\FF_p)$ has no natural group law, but
\[
  \tilde{E}(\FF_p)_{ns} := \{P \in \tilde{E}(\FF_p) \,|\, P \text{ is nonsingular}\}
  \]
is still a group with addition of points defined in the same way as for $E(\FF_p)$.

Looking at $E$ in the completion $\QQ_p$, we still have a map
\[\EQp \rightarrow \EFp\].
If we let $\EQp_0$ be the preimage of $\EFp_{ns}$ we get a group homomorphism
\[ \EQp_0 \rightarrow \EFp_{ns}. \]

\begin{defn}
  The \defin{Tamagawa Number of $E$ at $p$} is the number of cosets 
  $$c_p = \left| \frac{\EQp}{\EQp_0}
  \right|.$$
  If $p \nmid \Delta(E)$ then $c_p = 1$.
\end{defn}  

In \autoref{tamagawa}, we will compute the Tamagawa numbers at all
primes for the family of quadratic twists $E_n$. 
  
\section{The BSD Conjecture and Tunnell's Theorem}

During the 1960s, Bryan Birch and Peter Swinnerton-Dyer formulated, based
on numerical evidence, an influential conjecture relating the Hasse-Weil
L-function to the arithmetic invariants of $E$.

\begin{conj}[Birch Swinnerton-Dyer Conjecture] \normalfont
  \textit{The Hasse-Weil L-function $L(E,s)$ can be written as
  \[L(E,s) = C (s-1)^r + O((s-1)^{r+1})\] where}
\begin{equation} \label{eq:bsd}
  C = \frac{\#\text{Sha}(E) \, \Omega_E R_E}{\#Tors(\EQ)^2} \prod_p c_p
\end{equation}
\end{conj}

In particular, setting $s = 0$, it predicts the value of
\[0^r \cdot \frac{\# \Sha(E) \, \Omega_E R_E}{\# \Tors(\EQ)^2} \prod_p c_p .\]

In this project we will show that the predicted value for $L(E_n,1)$
is correct modulo 16.

The BSD conjecture is particularly powerful to gather information about
parametrised families of elliptic curves. We can then form a parametric
family of L-functions and hope that, by analysing how they change as we range
through the family, we can recover useful
arithmetic information about the original curves.

This can be seen quite clearly
for the $E_n$, since even though it is very difficult to tackle all of them
together artihmetically, their L-functions are just twists of $L(E_1,s)$ by a
quadratic character.
This idea culminates in the following remarkable result, proven using
the machinery of modular forms, which shows that the critical value
$L(E_n,1)$ takes a particularly simple form.

\begin{thm}[Tunnell's Theorem]
  \begin{equation} \label{eq:tunnell}
    L(E_n,1) = \begin{cases}
      \frac{\beta}{4\sqrt{n}}a_n^2 & \text{ if $n$ is odd} \\
      \frac{\beta}{2\sqrt{n}}a_{n/2}'^2 & \text{ if $n$ is even}
    \end{cases}
  \end{equation}

  where the $a_i, a'_i$ are coefficients of the fourier expansions of the
  functions $f, f'$ given by
  \begin{equation} \label{eq:mododd}
    f(z) = \sum\limits_{m=-\infty}^\infty a_m q^m
    = (\Theta(z) - \Theta(4z)) \left(\Theta(32z)-\frac{1}{2} \Theta(8z)\right) \Theta(2z)
  \end{equation}
  and
  \begin{equation} \label{eq:modeven}
    f'(z) = \sum\limits_{m=-\infty}^\infty a'_m q^m =
    (\Theta(z) - \Theta(4z)) \left(\Theta(32z)-\frac{1}{2} \Theta(8z)\right) \Theta(4z)
  \end{equation}
  with $q = e^{2\pi i z}$.
  
  Here $\Theta(z)$ is the theta-function given by
  \[ \Theta(z) = \sum\limits_{n = -\infty}^{\infty} q^{n^2} \text{ where } q =
    e^{2\pi iz}\]
  and
  \[\beta = \int_1^\infty \frac{dx}{\sqrt{x^3-x}}.\]
\end{thm}

\begin{proof}
  \cite[See][pages 325-328]{Tunnell}. 
\end{proof}
  
In this project we will take advantage of the fact that the coefficients of
$L(E_n,1)$ are given by relatively simple arithmetic functions, and use that
to verify the BSD conjecture modulo 16 for the family $E_n$.

To do this we will first compute all the invariants of $E_n$,
and then find a simple form for the coefficients of $f$ and $f'$ modulo
a high enough power of 2. This will enable us to predict the rank of $E_n$ and,
in some cases, the size of $\Sha(E_n).$.

\newpage

\chapter{Modular Forms}

Our goal in this section is to sketch the chain of results from the theory of
modular forms that make it possible to write the
critical values $L(E_n,1)$ of the Hasse-Weil L-function in terms of Theta functions. 

\section{Lattices and Modular points}

\begin{defn}
  A \defin{lattice} $L$ in the complex plane is an additive subgroup of the form
  \[L = \ZZ\omega_1 \oplus \ZZ\omega_2, \,\,\, \omega_1, \omega_2 \in \CC \]
  where $\omega_1$ and $\omega_2$ are not in the same line through the origin.
  A base $\langle \omega_1, \omega_2 \rangle$ is said to be oriented if
  $\omega_1/\omega_2$ is in the upper half plane $\HH$.
\end{defn}

From now on, we will write $\Gamma := SL(2,\ZZ)$.
A lattice $L$ will also be called a \defin{modular point for $\Gamma$}.
Lattices have the following basic properties:
\begin{prop}[Properties of Lattices] \label{lattice}
  Let $L = \langle \omega_1, \omega_2 \rangle, L' = \langle \omega_1', \omega_2'
  \rangle$ be lattices. We have:
  \begin{enumerate}[(i)]
  \item $L = L'$ as a subgroup of $\CC$ if and only if there exists a matrix $M
    \in \Gamma$ such that $(\omega_1', \omega_2') = M (\omega_1, \omega_2)$
    as vectors in $\CC^2.$
  \item $\CC / L$ and $\CC / L'$ are analytically isomorphic as additive groups
    if and only if $L$ and $L'$ are homothetic, i.e.
    $L' = \alpha L$ for some $\alpha \in \CC.$
  \item $\CC / L$ is analytically isomorphic to $\CC /\langle \tau, 1
    \rangle$ where $\tau = \omega_1/\omega_2$.
  \item Let $\tau, \tau' \in \HH = \{z \in \CC \, | \, \Im(z) > 0 \}$.
    Then $\CC / \langle \tau, 1 \rangle \simeq \CC / \langle \tau', 1 \rangle$
  if and only if there exists is a matrix $M = \left(
    \begin{smallmatrix}
      a & b \\ c & d
    \end{smallmatrix} \right) \in \Gamma$
    such that
    \[\tau' = \frac{a\tau+b}{c\tau +d}. \]
    When this is true we will write $\tau' = M\tau$.
  \end{enumerate}
\end{prop}
\begin{proof}
  The algebraic bits are standard calculations. For the results on analytic
  isomorphisms, see \cite[Appendix B.6, pages 168-169]{simple}.
\end{proof}

Our motivation for introducing lattices comes from the following facts:

\begin{prop}[Uniformization Theorem]
  Let $L = \langle \omega_1, \omega_2 \rangle$ be a lattice. Then
  \begin{enumerate}[(i)]
  \item $\CC/L$ is analytically isomorphic as an additive group
    to an elliptic curve in $\PP^2(\CC)$.
  \item Every elliptic curve over $\CC$ is obtained in this way.
  \end{enumerate}
\end{prop}
\begin{proof}
  \cite[See][Pages 131-134 and 136-137]{Granville}.
\end{proof}

\begin{cor}
  The isomorphism classes of elliptic curves over $\CC$ are in one-to-one
  correspondence to $\HH/\Gamma$ under the action of Proposition
  \autoref{lattice} (iv).
\end{cor}

Thus, the set $\HH/\Gamma$ can be considered as a moduli space for elliptic
curve over $\CC$. 

\begin{defn}
  It turns out to be useful to consider moduli spaces for elliptic curves with
  some extra structure. We define: 
  \begin{enumerate}[(i)]
  \item A ``\defin{modular point for $\Gamma$}'' s a lattice $L$.
  \item A ``\defin{modular point for $\Gamma_1(N)$}'' s a pair $(L,t)$ where $L$ is a
    lattice and $t \in \CC/L$ is a point of exact order $N$.
  \item A ``\defin{modular point for $\Gamma_0(N)$}'' s a pair $(L,S)$ where $L$ is a
    lattice and $S < \CC/L$ is a subgroup of order $N$.
  \item A ``\defin{modular point for $\Gamma(N)$}'' s a pair $(L, \{t_1,t_2\})$ where
    $t_1,t_2 \in \CC/L$ are a basis for the points of order $N$.
  \end{enumerate}
\end{defn}

From the Uniformization Theorem, we know these correspond to elliptic curves
over $\CC$ with some extra $N$-torsion data.
As it turns out, on each case we can find moduli spaces for equivalence classes of modular
points as a quotients $\HH / \Gamma'$, where $\Gamma'$ are certain subgroups of
$\Gamma$. This will justify the choice of notation for each $\Gamma'.$

\begin{defn}
  We define the following subgroups of $\Gamma$.
  \[\Gamma_1(N) = \left\{ 
    M \in \Gamma ; M \equiv
    \left(  
    \begin{array}{ccc}
      1 & * \\ 0 & 1
    \end{array} \right) \mod{N} \right\} 
\]
  \[\Gamma_0(N) = \left\{ 
    M \in \Gamma ; M \equiv
    \left(  
    \begin{array}{ccc}
      * & * \\ 0 & *
    \end{array} \right) \mod{N} \right\} 
\]
  \[\Gamma(N) = \left\{ 
    M \in \Gamma ; M \equiv
    \left(  
    \begin{array}{ccc}
      1 & 0 \\ 0 & 1
    \end{array} \right) \mod{N} \right\} 
\]
where $*$ denotes that there are no congruence conditions on that slot.
\end{defn}

It turns out that these groups are the right candidates to form moduli spaces of
more general modular points.

\begin{prop}
  For each $\Gamma' = \Gamma_1(N), \Gamma_0(N), \Gamma(N)$, the equivalence
  classes of isomorphic modular points for $\Gamma'$ are precisely given by
  $\HH/\Gamma'$ under the action of Proposition \autoref{lattice} (iv).
\end{prop}
If $\Gamma' < \Gamma$ contains $\Gamma(N)$ for some $N$, it is called a
\defin{congruence subgroup of level $N$}.

We also define a family of operators that act on modular points from
$\Gamma_1(N)$. Let $\mathcal{L} = \oplus \, \QQ (L,t)$ be the $\QQ$-vector space
of linear combinations of modular points $(L,t)$ for $\Gamma_1(N).$ Here the sum is over
all lattices $L$ with a tagged point $t$ of order $N$.

\begin{defn}[Hecke Operators] \label{hecke}
  The \defin{Hecke operator $T_n$} is the linear map $T_n : \LL \ra \LL$ acting
  on each basis vector $e_{L,t}$ by
  \[T_n((L,t)) = \frac{1}{n} \sum\limits_{L'} (L',t).\]
  The summation is over all lattices $L'$ containing $L$ such that
  \begin{enumerate}[(i)]
  \item $L'/L$ is a subgroup of $\CC/L$ of order $n$
  \item $t$ also has order $N$ in $L'$.
  \end{enumerate}
  We note that the sum is finite. This is because by condition (i), any lattice $L'$
  corresponds corresponds to a subgroup
  of order $n$ in $\frac{1}{n} L/L' \simeq (\ZZ/n\ZZ)^2.$
\end{defn}

\section{Modular Functions}

In this section we will define certain spaces of functions, called modular forms,
which transform
nicely with respect to the groups in the previous section. These functions will
turn out to be highly symmetrical. This symmetry, in turn, conveniently forces
them to live
in certain finite dimensional vector spaces. Thus, whenever we encounter a
function which transforms similarly to a known modular form, we can hope to find
it in the corresponding vector space as a linear combination of previously known
modular forms.

Our ultimate goal, and the main result of Tunnell's Theorem, is to
find a modular form which transforms similarly to the L-functions $L(E_n,s)$.
This will enable us to write the critical values $L(E_n,1)$ in terms of a
explicitly describable function.  

In order for this program to work, we will need to define increasingly more
complicated transformation rules. It will turn out that the odd coefficients of
$L(E_n,s)$ will be
related to a special function living in the space
$S_{3/2}(\tilde{\Gamma}_0(128)).$ In the next sections we build up the
vocabulary required to state the main results that make this possible.

\begin{defn}
  A holomorphic function $f : \HH \ra \CC$ is called \defin{weakily modular of
    weight $k$} if for all $\left(
    \begin{smallmatrix}
      a & b \\ c & d
    \end{smallmatrix}
  \right) \in \Gamma$ and $z \in \HH$,
  \[f \left( \frac{az+b}{cz+d} \right) = (cz+d)^k f(z). \]
  Furthermore,
  \begin{enumerate}[(i)]
  \item If $f$ has a Fourier series $$f(z) = \sum\limits_{n \in \ZZ} a_n q^n,$$
    where $q = e^{2\pi i z}$, with at most finitely many nonzero $a_n$ for $n <
    0$, then $f$ is called a \defin{modular function of weight $k$}. 
  \item If $a_n = 0$ for all $n < 0$, $f$ is called a \defin{modular form of
      weight $k$}. The space of such functions is written $M_k(\Gamma).$
  \item If we further have $a_0 = 0$, $f$ is called a \defin{cusp form of weight
    $k$}. The space of such functions is written $S_k(\Gamma).$
  \end{enumerate}
\end{defn}

\begin{remark}
  If $f \in S_k(\Gamma)$ and we further have $a_1 = 1$, we say $f$ is
  \defin{normalized}. It is clear that for any cusp form $f = \sum a_n q^n$,
  $a_1^{-1}f$ is a normalized cusp form.
\end{remark}

Substituting
$M = \left(
  \begin{smallmatrix}
    -1 & 0 \\ 0 & -1
  \end{smallmatrix}
\right)
$ we see that there are no
nonzero modular functions of weight $k$ if $k$ is odd.
As we mentioned in the introduction to this section, the spaces of modular /
cusp forms are particularly useful because they are also finite dimensional
vector spaces over $\CC.$

\begin{prop}
  Let $k$ be an even positive integer. Then
  \[\textnormal{dim}M_k(\Gamma) =
    \begin{cases}
      \lfloor \frac{k}{12}  \rfloor + 1, & \text{if } k \not\equiv 2 \mod{12} \\
      \lfloor \frac{k}{12}  \rfloor, & \text{if } k \equiv 2 \mod{12} \\
    \end{cases}
\]
  \[\textnormal{dim}S_k(\Gamma) =
    \begin{cases}
      \lfloor \frac{k}{12}  \rfloor, & \text{if } k \not\equiv 2 \mod{12} \\
      \lfloor \frac{k}{12}  \rfloor - 1, & \text{if } k \not\equiv 2 \mod{12} \\
    \end{cases}
\]
\end{prop}
\begin{proof}
  The proof comes by looking at the possible residues of $f$ using a contour
  integral along a fundamental domain of $\HH / \Gamma$.
  \cite[See][Propositions 8-9, Pages 115-118]{koblitz}. 
\end{proof}

\begin{example}[Eisenstein Series]
  Let $k$ be an even integer greater than 2 and set
  \[E_k(z) = \frac{1}{2} \sum_{\substack{m,n \in \ZZ \\ (m,n) =1}} \frac{1}{(mz+n)^k}.\]
  Then $E_k \in M_k(\Gamma).$ It is easy to see that $E_k$ transforms correctly
  under $\Gamma$, and computing its Fourier expansion one can see that it is
  indeed a modular form.
\end{example}

\begin{example}[Discriminant Form]
  Let $\Delta : \HH \ra \CC $ be the \defin{discriminant form} is defined by
  \[\Delta(z) = \frac{(2\pi)^{12}}{1728} \left( E_4(z)^3 - E_6(z)^2 \right).\]
  One can show that $\Delta(z) \in S_{12}(\Gamma)$, so it is a nonzero
  cusp form of the lowest
  possible weight. Under our interpretation of $\HH/\Gamma$ as a moduli space,
  $\Delta(z)$ turns out to be the familiar discriminant for
  the elliptic curves associated to the modular point given by $z$.
  If the curve $y^2 = x^3 + ax + b$ comes from the equivalence class of a lattice
  $\langle z,1 \rangle$, we have
  \[\Delta(z) = -16(4a^3 + 27b^2).\]
  This provides a very indirect proof that isomorphic elliptic curves have
  the same discriminant.
\end{example}

We now generalize our definitions to congruence subgroups. To do this, we
introduce the following notation: for $M = \left(
  \begin{smallmatrix}
    a & b \\ c & d
  \end{smallmatrix}
\right)$ and $f : \HH \ra \CC$, write
\[f (z) | [M]_k = (cz+d)^{-k} f\left( \frac{az+b}{cz+d} \right)\]

\begin{defn}
  Let $\Gamma'$ be one of the congruence subgroups of $\Gamma$. A holomorphic
  function $f: \HH \ra \CC$ is called \defin{weakily modular of weight $k$ for
    $\Gamma'$} if for all 
  $\left( 
    \begin{smallmatrix}
      a & b \\ c & d
    \end{smallmatrix}
  \right) \in \Gamma'$ and $z \in \HH$,
  \[f \left( \frac{az+b}{cz+d} \right) = (cz+d)^k f(z). \]
  Since $\Gamma'$ is a congruence subgroup, it contains $\Gamma(N)$ for some $N
  \geq 1$. In particular,  $$f \left( \left( 
    \begin{smallmatrix}
      1 & N \\ 0 & 1
    \end{smallmatrix}
  \right) z \right) = f(z+N) = f(z),  $$
  so $f$ is $N$ periodic. Let 
  \[f(z) = \sum\limits_{n \in \ZZ} a_n(q_N)^n \]
  where $q_N = e^{2\pi i z/N}$ be a Fourier expansion for $f$. 

  \begin{enumerate}[(i)]
  \item If for each $M \in \Gamma'$, the function $f(z) | [M]_k$ has a
  fourier expansion with finitely many nonzero negative terms, then $f$ is
  called a \defin{modular function of weight $k$ for $\Gamma'$}.
\item If furthermore all negative terms in the Fourier expansions of each
  $f(z) | [M]_k$
  are 0, then $f$ is called a \defin{modular form of weight
    $k$ for $\Gamma'$}. We also say \defin{$f$ is holomorphic at the cusps}.
  The space of such functions is written $M_k(\Gamma').$
  \item If the coefficient $a_0$ in all Fourier expansions from the previous
    items are also 0, then $f$ is called a \defin{cusp form of weight $k$ for
      $\Gamma'$}. We also say \defin{$f$ vanishes at the cusps}.
    The space of such functions is written $S_k(\Gamma').$ 
  \end{enumerate}
\end{defn}

If $f$ is a form for a congruence subgroup $\Gamma(N)$, we can choose $N$ to be
the least possible. In other words, we can choose the least $N$ such that $f$ is
$N$-periodic along the real axis. We then say is $f$ a \defin{form of level $N$}.

\begin{defn}
  If $f \in M_k(\Gamma(N))$ but $f$ is also in $M_k(\Gamma(M))$ for some
  positive divisor $M$ of $N$, we say $f$ is a \defin{old form of
    $M_k(\Gamma(N))$}. The space of old forms is written
  $M_k^{\text{old}}(\Gamma(N)).$ We can define the space
  $S_k^{\text{old}}(\Gamma(N))$ of old cusp forms in the same way.  
\end{defn}

In order to get more interesting modular forms, it will be necessary to consider
one further generalisation. Let $f \in M_k(\Gamma_1(N))$ and let $\chi$ be a
Dirichlet character modulo $N$. we define
\[M_k(N, \chi) = \left\{ f \in M_k(\Gamma_1(N)) \, | \,
    f(z) | [\gamma]_k = \chi(d)f(z), \text{ for all } \gamma =
  \left(
    \begin{smallmatrix}
      a & b \\ c & d
    \end{smallmatrix}
\right) \in \Gamma_0(N) \right\}\]

\begin{example} \label{ex:theta}
  Let
  \[\Theta^2(z) = \left( \sum\limits_{n \in \ZZ} q^{n^2} \right)^2.\]
  Then $\Theta^2 \in M_1(4,\chi)$ where $\chi(d) = (-1)^{(d-1)/2}$.
  This is obtained in \cite[Proposition
  30]{koblitz} by carefully consdering how $\Theta^2$ transforms under a set of
  generators for $\Gamma_1(4, \chi)$. \cite[Proposition 28]{koblitz} further
  shows that $M_1(4, \chi) = M_1(\Gamma_1(4))$, so in this case we recover a
  familiar congruence subgroup.
\end{example}

As we noted before, there is a one-to-one correspondence
between the points $z\in \HH$ and lattices homothetic to $\langle z, 1
\rangle$.
Extending this
analogy to functions, let $f \in M_k(\Gamma_1(N))$. We can define a complex
valued function
$F$ on the set of all modular points $(L,t)$ for $\Gamma_1(N)$ by
\[F(L,t) = f(z),\]
where $z$ is a point in $\HH$ such that $(\langle z,1 \rangle, \frac{1}{N})$
is a modular point homothetic to $(L,t).$ This pairing turns out to be
one-to-one between function $f \in M_k(\Gamma_1(N))$ and complex-valued
functions on modular points for $\Gamma_1(N)$ such that
\[F(\lambda L, \lambda t) = \lambda^{-k} F(L, t).\]
This extends the other types modular points in the obvious manner, and
provides further motivation for the defintion of modular forms of weight
$k$ and level $N$. The details are covered in
\cite[Section III-5, Pages 153-155]{koblitz}.

We now use the reverse correspondence to define Hecke operators $T_n$ on
congruence subgroups.

\begin{defn} \label{defin_hecke}
  The \defin{Hecke operator $T_n : M_k(\Gamma_1(N)) \ra M_k(\Gamma_1(N))$} by
  \[T_nf(z) = F(T_n(L,t)) := \frac{1}{n} \sum\limits_{L'} F((L',t))\]
  where $F, L$ and $t$ are defined in the remarks above, and the $T_n$ acts on
  modular points as defined on Definition \ref{hecke}.
\end{defn}

The next proposition gives an effectively computable well to work out the $T_n$. 

\begin{prop} \label{properties_hecke}
The operator $T_n$ satisfies the following additional properties:
  \begin{enumerate}[(i)]
  \item $T_n$ preserves cusp forms, so we can consider the linear map $T_n :
    S_k(\Gamma_1) \ra S_k(\Gamma_1).$ 
  \item $T_n$ also preserves the spaces $M_k(N, \chi)$ and $S_k(N, \chi).$
  \item We have
    \[T_n(f)(z) = n^{k-1} \sum\limits_\gamma f(z) | [\gamma]_k \]
    where the sum is over all elments in the left quotient $\frac{M}{\Gamma}$,
    where $M$ is the set of all 2x2 matrices with determinant $n$.
  \item Let $m, n$ be positive integers, then
    \[T_n \cdot T_m = \sum\limits_{d \mid (m,n)} d^{k-1} \cdot T_{nm/d^2}.\]
  \end{enumerate}
\end{prop}
\begin{proof}
  \cite[Section 4.1.2, Pages 61-64]{modular}.
\end{proof}
Proposition \autoref{properties_hecke}(iv) gives us a way to recursively work out
$T_n$ from knowing $T_p$ for all primes $p$ diving $n$.

The linear operators $T_n$ turn out to have eigenvectors when we restrict them
to the cusp forms $S_k(N, \chi).$

\begin{defn}
  Let $f \in S_k(N, \chi).$ We say \defin{$f$ is an eigenform} if for each $n
  \geq 1$ there exists some $\lambda_n \in \CC$ such that
  \[T_n f = \lambda_n f.\]
  This means that $f$ is an eigenvector with eigenvalue $\lambda_n$ for all the
  operators $T_n.$
\end{defn}

Most important examples of modular forms turn out to be eigenforms. When this is
true a lot can be concluded about its Fourier coefficients. 

Keeping with the theme of doing simple linear algebra in the spaces of modular
forms, last tool from of this section gives us an inner product for spaces
of cusp forms.

\begin{defn}
  Let $\Gamma'', \Gamma'$ be congruence subgroups with $\Gamma'' \subset
  \Gamma'$.
  Let $f, g$ be modular forms for $\Gamma''$ with at least one of them a cusp
  form. Then the \defin{Peterson inner product of $f$ and $g$} is define by
  \[\langle f,g \rangle = \frac{1}{[\overline{\Gamma'} : \overline{\Gamma''}]}
  \int f(x+iy) \overline{g(x+iy)} y^k \frac{dx dy}{y^2}\]
  where $\overline{\Gamma'} = \Gamma' / \{ \pm\text{Id}\}$ and the integral is over
  a fundamental domain for $\overline{\Gamma''}$.

  The proof that the integral converges for all $f, g$ can be found in
  \cite[Chapter III-5, page 170]{koblitz}. Once we know that, it is clear from
  the definition that $\langle \cdot \rangle$ defines a Hermitian inner product.
\end{defn}

The Peterson inner product interacts well with the previous definitions. For
instance, if $\chi$ is a Dirichlet character modulo $N$ and $c_n$ is either
square root of $\bar{\chi}(n)$, then the operator $c_n T_n$ is Hermitian on
$S_k(N, \chi)$. That
is
\[\langle c_n T_n f, g \rangle = \langle f, c_n T_n g \rangle\]
for every $f, g \in S_k(N,\chi).$

\begin{defn}
  The orthogonal complement of $S_k^{\text{old}}(\Gamma(N))$ under the Peterson
  inner product is called the space of \defin{new forms of level $N$}, and
  written
  \[S_k^{\text{new}}(\Gamma(N)) = S_k^{\text{old}}(\Gamma(N))^\perp.\]
  Since everything is finite dimensional, we have
  \[S_k(\Gamma(N)) = S_k^{\text{new}}(\Gamma(N)) \oplus S_k^{\text{old}}(\Gamma(N)).\]
  We can also define new forms for other congruence subgroups, for instance by
  letting
  \[S_k^{\text{new}}(\Gamma_1(N)) = S_k(\Gamma_1(N)) \cap
  S_k^{\text{new}}(\Gamma(N)).\]
\end{defn}

The next definition will take a prominent role later in the description of the
Shimura correspondence.

\begin{defn}
  A normalized form $f \in S_k^{\text{new}}(\Gamma_1)$ that is also an eigenform for all
  Hecke operators $T_n$ is called a \defin{newform}. 
\end{defn}

\newpage

\begin{prop}
  There exists an orthonormal basis of newforms for $S_k^{\textnormal{new}}(\Gamma_1(N))$.
\end{prop}
\begin{proof}
  \cite[See][Theorem 3.1, Pages 125-137]{lang}.
\end{proof}

For a Dirichlet series $L(E, s) = \sum \frac{a_n}{n^s}$, we let $f_{E(z)}$ be a
function on $\HH$ with Fourier expansion $f_{E(z)} = \sum a_n q^n.$ Conversely,
if $f$ is a modular form $f(z) = \sum b_n q^n$ we form its associated L-series
by $L_f(s) = \sum \frac{b_n}{n^s}.$

The motivation for all definitions so far comes from the following result:

\begin{prop} \label{Llevel}
  Let $L(E_n,s)$ be the Hasse-Weil L-function for the curve $y^2 = x^3-n^2x$.
  Then we have
  \begin{enumerate}[(i)]
  \item $f_{E_1} \in M_2(\Gamma_0(32))$
  \item $f_{E_n} \in M_2(\Gamma_0(32n^2))$.
  \end{enumerate}
\end{prop}
\begin{proof}
  See \cite[Pages 140-143]{koblitz} for a sketch. This is derived from a theorem
  of Weil, which says that something similar holds for all functions which satisfy
  a certain functional equation and a certain decay condition on its
  coefficients.
\end{proof}

Having found functions intimately related to $L(E_n,s)$ sitting into some
congruence subgroups, Tunnell took advantage of some deep properties of the
spaces $M_k(\Gamma_0(N))$ to find a way to paremetrise all of the critical
values $L(E_n,1)$ by the coefficients of a single form.

This is done using a theorem of Waldspurger, which in our case states the
following:

Let $g := f_{E_1} \in M_2(\Gamma_0(32))$, and let $L_g(\chi_n, s) = L(E_n,s)$
be the analytic continuation of the twist by $\chi_n$ of the L-series
corresponding to $g$. 
Then there exists a form $f(z) = \sum\limits_{n \in \ZZ} a_nq^n$ 
such that the critical values of
$L_g(\chi_n,1) = L(E_n,1)$ satisfy
\[L_g(\chi_n,1) = \lambda(n) a_n^2,\]
where $\lambda(n)$ can be effectively described.

It turns out that $f$ lives in the space $S_{3/2}(\tilde{\Gamma}_0(128))$ of
half-integral weight modular forms. We describe the construction of this space
in the next section. After that, we will describe the main tool used in
Waldspurger's theorem to find the form $f$, called the Shimura Correspondence.

\section{Forms of Half-integral Weight}

The desire of inventing a theory for forms of half-integral weight comes from
considering objects which transform in a way that is reminscent but more general
than classical forms.

\begin{example}
  Let $\Theta(z) = \sum q^{n^2}$, with $q = e^{2 \pi i z}$ as usual, be the
  Theta function.
  As we noted in
  \ref{ex:theta}, we have $\Theta^2 \in M_1(4,\chi)$. A classical calculation,
  carried out in \cite[Chapter III-4, Pages 148-149]{koblitz}, shows that
  \[\Theta(\gamma z) = \legendre{c}{d} \varepsilon_d \sqrt{cz+d} \,  \Theta(z),\]
  where $\legendre{c}{d}$ is the Jacobi symbol and
  \[\varepsilon_d =
    \begin{cases}
      1 & \text{if } d \equiv 1 \mod{4} \\ 
      -i & \text{if } d \equiv 3 \mod{4}.
    \end{cases}
  \]
  and the square root branch is taken so that the argument lies in $(-\pi/2,
  \pi/2 ]$
  This is, up to multiplication by a complex unit, very similar to what the
  transformation rule for a form of weight $1/2$ should look like.
  In general, one can write similar
  transformation rules for $\Theta^k$ with $k$ odd. 
\end{example}

The main obstruction to a theory of forms of half-integral weight is dealing
with the choice of branch for the square root. In order to explain Tunnell's
result, we will only need to work in the congruence subgroups $\Gamma_0(4N)$.
Recall that they consist of integer matrices of the form $
\left( \begin{smallmatrix}
  a & b \\ c & d
\end{smallmatrix} \right)
$ where $c \equiv 0 \, (4N)$ and $ad - bc = 1.$

In order to get the right definition we will need to generalize classical forms
in three directions
\begin{enumerate}
\item We will need to consider more general transformation rules, which not only
  scale correctly but also make the signs work out.
\item We will need to consider matrices living in a larger group, where the
  square root function doesn't have branches.
\item Once the first 2 steps are carried out, we will need to be careful in
  defining the appropriate holomorphicity conditions to get forms and cusp forms.
\end{enumerate}

\begin{defn} \label{automorphy}
  To carry out the first generalization, we take the transformation rule for the
  Theta function as a model and define the \defin{automorphy factor}. For
  $\gamma \in \Gamma_0(4),$ let
  \[j(\gamma, z) = \frac{\Theta(\gamma z)}{\Theta(z)} = \legendre{c}{d}
    \varepsilon_d \sqrt{cz + d}.\]
\end{defn}

Similar to the case for classical forms, we would want weight $k/2$ forms to
satisfy
\[f(z)|[\gamma]_{k/2} := j(\gamma,z)^{-k}f(\gamma z) = f(z).\]
On the other hand, working with square roots branches in $\Gamma_0(4)$ forces us to
define an operator $[\gamma]_{k/2}$ at a 4-sheeted cover of $GL_2^+(\QQ).$

\begin{defn}
  We define the \defin{metaplectic cover of $GL_2^+(\QQ)$} by
  \[G = \{(\alpha, \phi )\}\]
  where $\alpha = \left(
    \begin{smallmatrix}
      a & b \\ c & d
    \end{smallmatrix}
\right) \in GL_2^+(\QQ)$ and $\phi : \HH \ra \CC$ is a holomorphic function such
that
\[\phi(z)^4 = \frac{cz+d}{\sqrt{\det \alpha}}\]
The product in $G$ is defined to be
\[(\alpha, \phi(z))(\beta, \psi(z)) = (\alpha \beta, \phi(\beta z) \psi(z)).\]
\end{defn}
\cite[Pages 179-180]{koblitz} shows that $G$ is indeed a group and a quadruple cover of 
$GL_2^+(\QQ).$
For $\xi = (\alpha, \phi) \in G$, we define the operator $[\xi]_{k/2}$ by
\[f(z) | [\xi]_{k/2} = f(\alpha z)\phi(z)^{-k}.\]

Finally, to get the right transformation rules, note that we can lift subgroups
of $\Gamma_0(4)$ to
subgroups of $G$:

Let $\Gamma'$ be a subgroup of $\Gamma_0(4)$ of finite index. We define
\[\tilde{\Gamma} = \{(\gamma, j(\gamma,z)) \, | \, \gamma \in \Gamma'\}\]
and call $\tilde{\Gamma}'$ the lift of $\Gamma'$. For some $\gamma \in
\Gamma_0(4)$, we write lift of $\gamma$ to $G$ by writing
\[\tilde{\gamma} = (\gamma, j(\gamma,z)) \in G.\]

\begin{defn}
  Let $k$ be an odd integer, and let $\Gamma' \leq \Gamma_0(4)$ have finite index.
  Let $f : \HH \ra \CC$ be a holomorphic function. We say \defin{$f$ is weakily
    modular of weight $k/2$ for $\Gamma'$} if
  \[f | [\tilde{\gamma}]_{k/2} (z) = f(z), \forall \tilde{\gamma} \in
    \tilde{\Gamma}'.\]
\end{defn}

In the classical case, we defined holomorphicity at the cusps by considering
the Fourier expansions of every $f | [\gamma]$ for $\gamma$ ranging over the
congruence subgroup under consideration. There is an analogous but more
complicated way to ``move'' a modular form of half-integral weight by elements
of $G$ and get equivalent holomorphicity conditions.

For each weakily modular $f$ of weight $k/2$, and $\tilde{\gamma} \in \tilde{\Gamma}',$
\cite[page 180-182]{koblitz} shows that there exists a least integer $h$ and 
$t \in \{\pm 1, \pm i\}$ such that 
\[g = f | [\gamma]_{k/2} \]
and 
\[g(z) = g(z) | \left[ \left( \left(
        \begin{smallmatrix}
          1 & h \\ 0 & 1
        \end{smallmatrix}
\right), t \right) \right]_{k/2} = t^{-k}g(z+h) \]
If we write $t^k = e^{2\pi i r}, $ for $r \in \{0, \frac{1}{4}, \frac{1}{2},
\frac{3}{4}\}, $ then $e^{-2 \pi i r z / h}$ is $h$ periodic. Thus we can write
a Fourier expansion
\[g(z) = \sum\limits_{n \in \ZZ} a_n e^{2 \pi i z(n+r)/h}.\]

If for all $\tilde{\gamma} \in \tilde{\Gamma}'$, the corresponding $g$ has
$a_n = 0$ for all $n < 0$, we say $f$ is \defin{holomorphic at the cusps of
  $\Gamma'$}. 
If we further have $a_0 = 0$, we say $f$ \defin{vanishes at the cusps of $\Gamma'$}.

\begin{defn}
  Let $k \in \ZZ$, $\Gamma' < \Gamma_0(4)$ have finite index and let $f$ be a
  weakily modular form of weight $k/2$.
  \begin{enumerate}
  \item If $f$ is holomorphic at every cusp of $\Gamma'$, we say $f$ is a
    \defin{modular form of weight $k/2$}. The space of such functions is written 
    $M_{k/2}(\tilde{\Gamma})$.
  \item If $f$ also vanishes at every cusp, we say $f$ is a \defin{cusp form of
      weight $k/2$}. The space of such functions is written $S_{k/2}(\tilde{\Gamma}').$
  \end{enumerate}
\end{defn}

\begin{example}[Eisenstein Series of Half-Integer Weight]
  Let $k \geq 5$ be an odd integer, and set
   \[E_{k/2}(z) = \sum_{\substack{4 \mid m,n > 0 \\ (m,n) = 1}} \legendre{m}{n} 
    \varepsilon_n^k \frac{1}{(mz + n)^{k/2}}.\]
  Then \cite[Page 186]{koblitz} shows that $E_{k/2} \in M_{k/2}(\tilde{\Gamma}_0(4)).$
\end{example}

As with integral weight forms, there is a theory showing finitely dimensionality
and computing the dimensions of spaces for each weight. Half-integral weight
forms also admit Hecke operators.  

Since we lose the analogies from modular points in the $k/2$ case, it becomes
harder to define $T_n$ geometrically. The definition we will give here uses the
alternative double coset approach, which could also have been employed in
defining $T_n$ for classical forms. This algebraic apparatus gives
rise to the theory of Hecke modules, which can be used to generalize
the concepts from this section even further. We begin giving an alternative
expression for the $T_n$ for classical forms.

\begin{prop} \label{hecke_alt}
  Let $n$ be positive integers, and let $\Delta^n$ be the set of 2x2 matrices
  with integers entries and determinant $n$. Recall that $\Gamma$ is the full
  modular group $SL_2(\ZZ).$ We have:
  \begin{enumerate}[(i)]
  \item For any $\alpha \in \Delta^n$, there are only finitely many disjoint
    double cosets $\Gamma \alpha \Gamma$ in $\Delta^n.$ A complete set of double
    coset representatives is given by $\alpha = \left(
      \begin{smallmatrix}
        a & 0 \\ 0 & a b
      \end{smallmatrix}
    \right)$  where $a, b$ run through all positive integers such that $n =
    a b^2.$
    In particular, if $n$ is squarefree, we have $\Delta^n = \Gamma \left(
      \begin{smallmatrix}
        1 & 0 \\ 0 & n
      \end{smallmatrix}
    \right) \Gamma$, and if $n = p^2$ is the square of a prime, $\Delta^{p^2} = \Gamma \left(
      \begin{smallmatrix}
        1 & 0 \\ 0 & p^2
      \end{smallmatrix}
    \right) \Gamma \amalg p \Gamma$.
  \item For any double coset $\Gamma \alpha \Gamma \subset \Delta^n$ with
    $\alpha \in \Delta^n$, we have $\Gamma \alpha \Gamma = \Gamma \gamma_1
    \amalg \cdots \amalg \Gamma \gamma_k$, so the double coset splits as a
    finite disjoint union of single cosets.
  \end{enumerate}
\end{prop}
\begin{proof}
  \cite[See][Chapter IV-3, Pags 202-203]{koblitz}.
\end{proof}

These special properties of $\Delta^n$ allow us to give an alternative
definition for the operators $T_n$, as an average not over modular points, but
over coset representatives.

\begin{defn}[Alternative definition of classical Hecke operator]
  Let $k, n$ be positive integers with $k$ even. For $f \in M_k(\Gamma),$ set
  \[f | [\Gamma \alpha \Gamma]_k = \sum\limits_j f | [\alpha \gamma_j]_k\] where the sum
  is over all right cosets $\Gamma \alpha \gamma_j \subset \Gamma \alpha
  \Gamma.$ Then
  \[T_n f = n^{(k/2)-1} \sum f | [\Gamma \alpha \Gamma]_k,\]
  where the sum is over all double cosets of $\Gamma$ in $\Delta^n.$
  \cite[Chapter III-5, Page 167]{koblitz} shows that the sum is well defined,
  and that this expression agrees with
  how we defined the $T_n$ in \autoref{defin_hecke}.
\end{defn}

We can now generalize this construction to forms of half-integral weight. Recall
that $G$ is the quadruple cover of $GL_2^+(\QQ)$ given by
\[G = \left\{ (\alpha, \phi(z)) \, | \, \alpha = \left(
      \begin{smallmatrix}
        a & b \\ c & d
      \end{smallmatrix}
    \right) \in GL_2^+(\QQ)
    \text{ and } \phi(z)^4 = \frac{cz+d}{\sqrt{\det \alpha}} \right\}\]
and
\[\tilde{\Gamma}_0(4) = \left\{ (\alpha, j(\alpha,z)) \, | \, \alpha \in
    \Gamma_0(4) \right\}\]
where $j(\alpha,z)$ is the automorphy factor defined in \autoref{automorphy}.

In order to make an equivalent construction of the double coset operator for
subgroups of $G$, we let
\[\xi_n = \left( \left(
      \begin{smallmatrix}
        1 & 0 \\ 0 & n
      \end{smallmatrix}
    \right), \sqrt[4]{n} \right)\]
and consider the double cosets of the form
$\tilde{\Gamma}_1(N) \xi_n \tilde{\Gamma}_1(N)$. The following proposition
generalizes the double coset decomposition in Proposition \autoref{hecke_alt}
to $\tilde{\Gamma}_1(N).$

\begin{prop} \label{hecke_gen}
  For any positive integer $n$, the double coset
  $\tilde{\Gamma}_1(N) \xi_n \tilde{\Gamma}_1(N)$ splits as the disjoint union
  of finitely many right cosets
  $$\tilde{\Gamma}_1(N) \xi_n \tilde{\Gamma}_1(N) =
  \tilde{\Gamma}_1(N) \xi_n \tilde{\gamma_1} \amalg \cdots \amalg
  \tilde{\Gamma}_1(N) \xi_n \tilde{\gamma_k}$$
  where $\tilde{\gamma}_i = (\gamma_i, 1)$ for some $\gamma_i \in \Gamma_1(N).$ 
\end{prop}
\begin{proof}
  \cite[See][Chapter IV-3, Pages 203-204]{koblitz}.
\end{proof}

For $f \in M_{k/2}(\tilde{\Gamma}_1(N))$, we can then define an analogous double
coset action by
\[f | [\tilde{\Gamma}_1(N) \xi_n \tilde{\Gamma}_1(N)]_{k/2} = 
  \sum\limits_j f | [\xi_n \tilde{\gamma}_j]_{k/2},\]
where the sum is over the coset representatives from Proposition
\autoref{hecke_gen}.

The main difference in the theory for Hecke operators of forms of half-integral
weight comes from the fact that if $(n, N) = 1$ and $n$ is not a perfect square,
then
\[f | [\tilde{\Gamma}_1(N) \xi_n \tilde{\Gamma}_1(N)] = 0. \]
This means that when searching for eigenforms for the generalizations of the
$T_n$, it is not helpful to consider $n$ that are not perfect squares, since
then the only eigenform for $T_n$ would be 0. We thus restrict our definition of
$T_n$ for the case where $n=p^2$ is the square of a prime.

\begin{defn}
  Let $p$ be a prime number, and $f \in M_{k/2}(\tilde{\Gamma}_1(N))$. The
  \defin{Hecke operator $T_{p^2}$} is defined by
  \[
    \begin{split}
      T_{p^2} f &= p^{(k/2)-2} f | [\tilde{\Gamma}_1(N) \xi_{p^2}
      \tilde{\Gamma}_1(N)]_{k/2} \\
      &= p^{(k/2)-2} \sum\limits_j f(z) | [\xi_{p^2}\tilde{\gamma}_j]_{k/2}
    \end{split}
  \]
  where
  \[\xi_{p^2} = \left( \left(
        \begin{smallmatrix}
          1 & 0 \\ 0 & p^2
        \end{smallmatrix}
      \right), \sqrt{p} \right)\]
  and the sum is over the coset representatives from Proposition \autoref{hecke_gen}. 
  If for every prime $p$ there exists some $\lambda_p \in \CC$ such that
  $T_{p^2} f = \lambda_p f$, we call $f$ an \defin{eigenform for the $T_{p^2}$}. 
\end{defn}

In the next section we will see that certain cusp forms which are also eigenforms for all
$T_{p^2}$ actually correspond to classical forms in a surprising fashion.

\section{The Shimura Correspondence and Tunnell's Theorem}

\begin{thm}[Shimura Correspondence]
  Let $k \geq 3$ be an odd integer, $\lambda = \frac{k-1}{2}$, $N$ a multiple of
  4 and $\chi$ a Dirichlet character modulo $N$. Let $f(z) = \sum a_n q^n \in
  S_{k/2}(\tilde{\Gamma_0(N)})$ be an eigenform for $T_{p^2}$ with eigenvalue
  $\lambda_p$ for all primes $p$. Define a function $g$ with Dirichlet
  L-function and Euler product
  \[g_L(s) = \sum\limits_{n=1}^\infty \frac{b_n}{n^s} = \prod\limits_p
    \frac{1}{1 - \lambda_p p^{-s} + \chi(p)^2 p^{k-2-2s}}.\]
  Then $g \in M_{k-1}(N/2, \chi^2)$.
  If $k \geq 5$, then $g$ is a cusp form. We call $g$ the
  \defin{Shumura lift} of $f$, and write
  \[g = \Shim(f).\]
\end{thm}

Kohnen improved on this result for a specific case where $N = 4$, which is
precisely the one useful for Tunnell's theorem. Let
\[S_{k/2}^+ = \{f = \sum a_n q^n \in S_{k/2}(\tilde{\Gamma}_0(4)) \, | \,
  a_n = 0 \text{ if } (-1)^\lambda \equiv 2 \text{ or } 3 \mod{4}\}.\]

\begin{thm}
  The Shimura map actually gives an isomorphism
  \[S_{k/2}^+(\tilde{\Gamma}_0(4)) \ra S_{k-1}(\Gamma).\]
\end{thm}

Based on these ideas, Waldspurger proved a result which uses the Shimura
correspondence to parametrise the critical values of $L$ functions coming from
modular forms. The general result is very complicated. The following
specialization is given in Tunnell's paper \cite[Page 328]{Tunnell}.

\begin{thm}[Waldspurger's Theorem]
  Let $g \in M_{k-1}(N, \chi^2)$ be a newform such that $g = \Shim(f)$, for
  $f \in M_{k/2}(\tilde{\Gamma}_0(M))$. Assume $16 \mid N$. Then there exists a
  function $A(t)$ from squarefree integers to $\CC$ such that
  $$A(t)^2 \varepsilon(\chi^{-1} \chi_{-1}^{(k-1)/2} \chi_t, 1/2)
  =2(2\pi)^{(1-k)/2} \Gamma\left(\frac{k-1}{2}\right)
  L\left(g \, \chi^{-1} \chi_{-1}^{(k-1)/2}
      \chi_t, \frac{k-1}{2}\right).$$

  Futhermore, for each positive integer $N$, there exists a finite set of explicitly
  described functions $c(n)$, specified by 11 equations, such that the sums
  \[\sum\limits_{n \textnormal{ squarefree}} A(n)c(n)q^n,\]
  span the preimages of $\phi$ of level $N$ and character $\chi$ under the
  Shimura map.
\end{thm}

Recall that if $L(s) = \sum \frac{a_n}{n^s}$ is a Dirichlet series, we can form
a new function with Fourier expansion $f_L(z) = \sum a_n q^n$, where $q = e^{2
  \pi i z}$. When $L$ is the Hasse-Weil L-function, we saw in Proposition
\autoref{Llevel} that
\[f_{E_n} \in M_2(\Gamma_0(32 n^2)).\]

We will be interested in the case where $k = 3$, so that the Shimura map takes
forms of weight $3/2$ to forms of weight $2$,
where $f_{L(E_1)}$ lives. In this setting, Tunnell
saw that Waldspurger's theorem simplifies considerably.
First, he computes all preimages of $f_{L(E_1)}$
under the Shimura map.
It turns out to be necessary to work at level 128, but by finding a basis
for $S_{3/2}(\tilde{\Gamma}_0(N), \chi)$ he manages to write the preimages of
$f_{L(E,1)}$ under the Shimura map in
terms of theta functions.

By observing carefully what Waldspurger's theorem
says for the form $f_L$, Tunnell noted that
there are only 4 options for the $c(n)$, and by carefully comparing coefficients
he was able to arrive at his result:

\begin{thm}[Tunnell's Theorem]
  Let
  \[f_1(z) = (\Theta(z)-\Theta(4z))(\Theta(32z) - \frac{1}{2}\Theta(8z))
    \in S_1(\Gamma_0(128)).\]
  Then
  \[f_1(z)\Theta(2z), f_1(z)\Theta(8z) \in S_{3/2}(\tilde{\Gamma}_0(128)) \]
  and
  \[ f_1(z)\Theta(4z), f_1(z) \Theta(16z) \in
    S_{3/2}(\tilde{\Gamma}_0(128), \chi_2)\]
  are a maximal set of linearly independent eigenforms for all of the $T_{p^2}$,
  whose image under the Shimura lift is the modular form $f_{L(E_1)}$.

  Let $n$ be a squarefree odd positve integer. Then Waldspurger's theorem implies:
  \[L(E_n,1) = \frac{\beta}{4\sqrt{n}} a_n^2 \]
  and
  \[L(E_{2n},1) = \frac{\beta}{2 \sqrt{2n}} b_n^2 \]
  where $\beta = \int_1^\infty \frac{dx}{\sqrt{x^3-x}}.$
\end{thm}
\begin{proof}
  \cite[See][Theorem 3, Page 328-329]{Tunnell}.
\end{proof}

\newpage

\chapter{Galois Cohomology}

\section{Group Cohmology}

We begin by recalling some concepts from algebra.
Let $G$ be a finite group. We define the \defin{group ring $\ZZ[G]$} to
be the ring of formal sums
\[ \ZZ[G] = \left\{ \sum\limits_{g \in G} x_i g \, | \, x_i \in \ZZ  \right\} \]
with identity $1 \cdot e_G$ and addition and multiplication defined by
\[\left( \sum\limits_{g \in G} x_g g \right) + \left( \sum\limits_{g \in G} y_g
    g \right)
= \sum\limits_{g \in G} (x_g+y_g)g\]
and

\[\left( \sum\limits_{g \in G} x_g g \right) \cdot \left( \sum\limits_{h \in G} y_h
    h \right)
= \sum\limits_{g, h \in G} (x_gy_h)gh\]

We say an abelian group $A$ is a \defin{$G$-module} if it is a module
for the ring $\ZZ[G]$. 

If $A$ and $B$ are $R$-modules for a ring $R$, recall that
$\textnormal{Hom}_R(A,B)$ is the group of module homomorphisms from $A$ to $B$.
Recall that an exact sequence
\[E: 0 \ra B \ra E \ra A \ra 0\]
of module homomorphism is called an \defin{extension of $A$ by $B$}. If we have
two extensions
\[E_1: 0 \ra B \xrightarrow[]{f} E \xrightarrow[]{g} A \ra 0\]
\[E_2: 0 \ra B \xrightarrow[]{f'} E' \xrightarrow[]{g'} A \ra 0\]
we can form the \defin{Baer sum of $E_1$ and $E_2$} by
\[E_1 + E_2 : 0 \ra B \ra Y \ra A \ra 0\]
where
\[Y = \frac{\{(e,e') \in E \oplus E' \, | \, g(e) = g'(e')\}}{\{
    (f(b),0) - (0, f'(b)) \, | \, b \in B\}}\]

The set of extensions of $A$ by $B$ is called $\textnormal{Ext}^1_R (A,B).$ We saw in
MATH3201 that this is an abelian group with addition given by the Baer sum.

\begin{defn}
  The \defin{zeroth and first cohomology groups of $A$} are defined by
  \[H^0 (G, A) = \textnormal{Hom}_{\ZZ[G]}(\ZZ, A)\] and
  \[H^1 (G, A) = \textnormal{Ext}^1_{\ZZ[G]} (\ZZ, A)\] where $\ZZ$ is considered the
  trivial $G$-module where $g x = x$ for every $x \in \ZZ, g \in G$. 
\end{defn}

We can also give alternative definitions for the cohomology groups in terms of
cycles and boundaries.
Let $\phi : \ZZ \rightarrow A$ be a module homomorphism. Then
\[\begin{split} \phi(1) &= \phi(g \cdot 1) \,\,\,\, \forall g \in G \\
    &= g \cdot \phi(1) , \end{split}\]
so $\phi(1) \in A^G = \{x \in A \, | \, gx = x, \forall g \in G\}$, the set
of elements of $A$ at which $G$ acts trivially. But $\phi$ is
completely determined by the image of 1, so we can set
\[ H^0 (G, A) = \text{Hom}_{\ZZ[G]}(\ZZ, A) = A^G .\] 

In order to recover $H^1$, note that
we have a surjective homomorphism $\phi: \ZZ[G] \ra \ZZ$ given by
\[\sum\limits_{g \in G} x_gg \mapsto \sum\limits_{g \in G} x_g,\]
which gives a presentation
\[0 \ra \text{ker}(\phi) \ra \ZZ[G] \ra \ZZ \ra 0\]
of the $G$-module $\ZZ$. 

Using this presentation we may write $H^1(G,A)$ as 
\[H^1(G, A) = \frac{Z^1(G,A)}{B^1(G,A)}\]
where
\[Z^1(G,A) = \{ \phi : G \rightarrow A \, | \phi(gh) = \phi(g) + g \phi(h)\}\]
\[B^1(G,A) = \{ \delta \in Z^1 \, | \, \exists a \in A \,\,\text{such that}\,\, \delta(g)
  = ga - a , \forall g \in G\}\]

The following proposition shows that $H^1$ measures, is some sense, the lack of
exactness of the functor of $G$-modules to abelian groups given by $A \mapsto A^G.$

\begin{prop}
  For any short exact sequence of $G$-modules
  \[ 0 \rightarrow A \rightarrow B \rightarrow C \rightarrow 0\]
  we can form the long exact sequence
  \[ 0 \rightarrow H^0(G, A) \rightarrow H^0(G,B) \rightarrow H^0(G,C)
    \rightarrow H^1(G, A) \rightarrow H^1(G,B) \rightarrow H^1(G,C) \]
\end{prop}

\begin{proof}
  \cite[See][Appendix B, Pages 416-417]{arithmetic}.
\end{proof}

\section{Galois Cohomology}

We will now transport the machinery of group cohomology to the setting of
field extensions.
All throughout this section, we will assume $K$ is a perfect field. We recall
this means that every extension of $K$ is separable. 
We also let $L : K$ be a finite degree Galois
extension with Galois group $G_{L:K}$.
A \defin{Galois module $A$} is a module over $G_{L:K}$.

\begin{example}
  We can consider the Galois modules $A = L \simeq K[G], $ or $A =
  L^{\times}$ where $L^{\times}$ is the multiplicative group of $L$.
\end{example}

\begin{example}
  If $E$ is an elliptic curve over $K$ then $A = E(L)$ is a Galois module.
  Recall the addition formulas (\autoref{eq:adddiff}) for an elliptic curve given by 
  \[E: y^2 = x^3 + ax^2 + bx + c, \text{ with } a, b \in K.\]
  
  Let $P_1, P_2 \in E(L)$. 
  If $P_1 = (x_1, y_1)$ and $P_2 = (x_2,y_2)$, we have $P_1+P_2 = (x_3,-y_3)$,
  where
  \[x_3 = \lambda^2 - a - x_1 - x_2\]
  and $\lambda = \frac{y_2-y_1}{x_2-x_1}.$ The $y$ coordinate is then given by
  \[y_3^2 = x_3^3 + ax_3 + b.\]
  
  Thus, both coordinates of $P_1+P_2$ are given by polynomials with coefficients
  in $K$. 
  For any $\sigma \in G_{L:K}$, we then have
  \[x(\sigma(P_1+P_2)) = \sigma(x_3) = x(\sigma(P_1) + \sigma(P_2)),\]
  and an identical expression holds for the $y$-coordinate.
  
  Thus, $\sigma(P_1+P_2) = \sigma(P_1) + \sigma(P_2), \forall \sigma \in
  G_{L:K}$, so $E(L)$ is indeed a Galois module. 

\end{example}

\begin{defn}
  The \defin{zeroth and first Galois cohomology groups} are written
  \begin{equation*}
    \begin{split}
      H^0(L:K, A) &= H^0(G_{L:K}, A) = A^{G_{L:K}} \\
      H^1(L:K, A) &= H^1(G_{L:K}, A)
     \end{split}
   \end{equation*}
\end{defn}

The following result gives an important terminating condition for the
long exact sequences:

\begin{thm}[Hilbert's Theorem 90]
  For any finite Galois extension $L:K$, we have
  \[ H^1(L : K, L^{\times}) = 0\]
  where $L^\times$ is the multiplicative group of $L$.
\end{thm}
\begin{proof}
  \cite[See][Chapter X, page 150]{cohomology}
\end{proof}

Unpacking the definitions, we see that if $\phi : G_{L:K} \ra L^\times$ is a map
satisfying
\[\phi(gh)=\phi(g) \cdot g (\phi(h)),\]
then there exists some $\lambda \in L^\times$ such that
$$\phi(g) = \frac{g(\lambda)}{\lambda}, \text{ for all } g \in G_{L:K}. $$

In what follows we will let $L = \bar{K}$, the algebraic closure of $K$ and let
$G_K = G_{\bar{K}:K}$ be the absolute Galois group of $K$.
This extension is usually infinite, so
it will be necessary to make amendmends to the previous defintions. 

\begin{defn}
  A $G_K$-module $A$ is called a \defin{continuous $G_K$-module}
  if for all $g \in G_K$ and $ a \in A$,
  there exists a finite Galois extension $L:K$ such that $g(a)$
  depends only on the image of $g$ in $L$. In other words, $g(a)$ is determined
  by the coset of $g$ modulo $G_{\bar{K}:L}$.
\end{defn}

The definition of continious Galois module guarantees that, at least locally, we
can still work with finite extensions.

\begin{example}
  $\bar{K}$ and $ \bar{K}^{\times}$ are continuous $G_K$-modules.

  To see this in the first case,
  note that for $\alpha \in \bar{K}$, by definition $\alpha$ is algebraic over
  $K$, so $K(\alpha) : K$ is finite, with degree equal to the degree of the
  minimal polynomial of $\alpha$ over $K$.
  But then, for any $\alpha \in K$ and $g \in G_K$, the number $g(\alpha)$ is a conjugate
  of $\alpha$, and hence also lies in $K(\alpha).$ Thus, the value of
  $g(\alpha)$ depends only on the image of $g$ in $L$, as wanted.
\end{example}

To form cohomology groups for continuous Galois modules, set
\[H^1_{\textnormal{cts}}(K,A) = \frac{Z^1_{\text{cts}}(K,A)}{B^1(K,A)}\]
where
\begin{equation*}
  Z^1_{\text{cts}}(K,A) = \left\{
    \begin{aligned}
      &\phi : G_K \rightarrow A \, | \, \phi \in Z^1(G_K,A) \text{ and }
     \text{there exists a finite extension } L : K \\ 
     &\text{ such that } \phi(g)
      \text{ depends only on } g \text{ modulo } G_{\bar{K}:L}
    \end{aligned}
\right\}.
\end{equation*}

\begin{remark}
  Because $A$ is continuous, it follows that $B^1 \subset Z^1_{\text{cts}}$, so
  the quotient is well defined.
\end{remark}

\begin{lemma}
  $E(\bar{K})$ is a continuous $G_K$-module.
  If $K = \QQ$, we have 
  $$H^0(\QQ,E(\bar{\QQ})) = E(\bar{\QQ})^{G_{\bar{\QQ}:\QQ}} = E(\QQ).$$
\end{lemma}
\begin{proof}
  For $P = (x,y) \in E(\bar{K})$, let $L$ be the field generated
  by the coordinates of $P$. Then $P \in E(L)$ and $L$ is finite. This is
  because $x, y$ are algebraic over $K$.

  But then $g (P) = P, \forall g \in G_{\bar{K} : L}$, so the value of $g(P)$
  for some $g \in G_K$ is entirely determined by $g$ modulo $G_{\bar{K}:L},$ as wanted.
\end{proof}

We also have an extension of Hilbert's Theorem 90 to the continuous setting:

\begin{thm}
  Let $K$ be a perfect field. We have
  \[H^1_\textnormal{cts}(\bar{K}:K, \bar{K}^\times) = 0.\]
\end{thm}

\begin{proof}
  The idea of the proof is to take advantage of the finiteness conditions
  afforded by continuity, and reduce the problem to the finite extension case.
  We will show that $Z^1_\text{cts} (\bar{K}:K, \bar{K}^\times) = B^1(\bar{K}:K,
  \bar{K}^\times).$

  Let $\phi : G_K \ra \bar{K}^\times $ with $\phi \in Z^1_{\text{cts}}.$ By
  continuity, there exists a finite extension $L:K$ such that for $g \in G_K$,
  the value of $\phi(g)$ depends only on the restriction of $g$ to $L$. Thus, we
  have a map 
  \[\phi: G_{L:K} \ra \bar{K}^\times, \]
  and $G_{L:K}$ is finite. Now let $L_1:L$ be the field extension generated
  by the images of $\phi$ in $\bar{K}^\times$. This is a finite extension by
  construction. Finally, let $L_2:K$ be the normal closure of $L_2:K$, which is a
  Galois extension, since we are assuming $K$ is a perfect field.

  Putting everything together, note we can consider $\phi$ as a map
  \[\phi: G_{L_2:K} \ra L_2^\times\]
  by construction, so $\phi \in Z^1(L_2 : K, L_2^\times)$. But by Hilbert's
  Theorem 90, $H^2(L_2:K, L_2^\times) = 0$, so we must have $\phi \in B^1(L_2:K,
  L_2^\times).$
  
  By the definition of $B^1$, this means that we can write for all $g \in G_K,$ 
  \[\phi(g) = \frac{g(\lambda)}{\lambda},\]
  for some $\lambda \in L_2^\times \subset \bar{K}^\times.$
  Thus, $\phi \in B^1(\bar{K}:K, \bar{K}^\times),$ and we have $H^1(\bar{K}:K,
  \bar{K}^\times = 0).$


  
\end{proof}
  
Similarly to the group case, if we have a short exact sequence of continuous $G_K$-modules
\[ 0 \ra A \ra B \ra C \ra 0\]
we can form a long exact sequence of Galois cohomology groups
\[0 \ra A^{G_K} \ra B^{G_K} \ra C^{G_K} \ra H^1(K,A) \ra H^1(K,B) \ra H^1(K,C).\]
It will be this sequence that will allow us to tackle the calculation of the
rank of the elliptic curves $E_n$ explicitly.

\begin{remark}
  From now on we will write $H^1(\QQ, E)$ for the group $H^1(\QQ, E(\bar{\QQ}))$.
\end{remark}

\section{Applications to Elliptic Curves} \label{sec:applications}
A crucial step in the proof of the Mordell-Weil theorem is the study of the size
of the quotient $E(\QQ) / 2 E(\QQ)$. In curves with at least one 2-torsion
point, this can be done with the help of an isogeny.

\begin{remark}
  From now on, for any morphism $\phi : A \ra B$, we
  will write $$\text{ker}(\phi) = A[\phi].$$
\end{remark}

Let $$E : y^2 = x^3 + ax^2 + bx$$ be an elliptic curve over $\QQ$. We know $E$
has the rational points $\OO$ and $ T = (0,0)$. By the Nagell-Lutz theorem, we
know that $T$ has order 2 in $E(\QQ).$ This is the most general case we have to
consider, since if $E$ has a 2-torsion point, we can translate it to the origin
to get a birationally equivalent curve which contains the point $(0,0).$

We also consider the curve
\[ \bar{E} : y^2 = x^3 + \bar{a}x^2 + \bar{b}x \]
where $\bar{a} = -2a$ and $\bar{b} = a^2 - 4b$. Repeating this process yields
the curve
\[ \bar{\bar{E}} : y^2 = x^3 +  4ax^2 + 16bx\]
which is birationally equivalent to $E$ by the transformation $y \mapsto 8y,
x \mapsto 4x$.

\begin{prop}
  Let $E, \bar{E}$ be as above. The maps $\phi : E \rightarrow \bar{E}$ and
  $\psi : \bar{E} \rightarrow E$ defined by
  \[\phi(P) =
    \begin{cases}
      (\frac{y^2}{x^2}, \frac{y(x^2-b)}{x^2}), & \text{ if } P \neq \OO, T \\
      \bar{\OO}, & \text{ if } P = \OO \text{ or } P = T
    \end{cases}\]
  and
  \[\psi(P) =
    \begin{cases}
      (\frac{\bar{y}^2}{4\bar{x}^2}, \frac{\bar{y}(\bar{x}^2-\bar{b})}{8\bar{x}^2}),
      & \text{ if } P \neq \bar{\OO}, \bar{T} \\
      \bar{\OO}, & \text{ if } \bar{P} = \bar{\OO} \text{ or } \bar{P} = \bar{T}
    \end{cases}\]
  are elliptic curve isogenies, $\text{Ker}(\phi) = \{\OO, T\}$ and
  \[ \psi \circ \phi (P) = 2P , \text{ for all points } P \in E.\]
\end{prop}
\begin{proof}
  \cite[See][Chapter 4, page 79]{rational}.
\end{proof}

\begin{lemma} \label{lemma:rankformula}
  If $E(\QQ) / \psi(\bar{E}(\QQ))$ and $\bar{E}(\QQ) / \phi(E(\QQ))$ 
  are finite, then so is $E(\QQ)/2E(\QQ)$.
  In fact, the rank $r$ of $E$ satisfies
  \[2^r = \frac{\#E/\psi(\Eb) \cdot \#\Eb/\phi(E)}{4}\]
  where all curves are understood to be over $\QQ.$
\end{lemma}
\begin{proof}
  \cite[See][Chapter 4, page 83]{rational}.
\end{proof}

We are thus led to consider the quotient $E(\QQ) / \psi(\bar{E}(\QQ))$ (the
other one can be treated identically).

By the proposition, we have a short exact sequence of $G_{\QQ}$-modules
\[ 0 \rightarrow \{\OO, T\} \rightarrow \bar{E}(\bar{\QQ}) \xrightarrow[]{\psi}
  E(\bar{\QQ})
  \rightarrow 0,\]
and $\{\OO, T\} \simeq \ZZ/2\ZZ$.

Taking Galois cohomology we get the long exact sequence
\[ 0 \rightarrow \ZZ / 2\ZZ \rightarrow \bar{E}(\QQ) \xrightarrow[]{\psi} E(\QQ)
  \rightarrow H^1(\QQ, \ZZ/2\ZZ) \rightarrow H^1(\QQ, \bar{E}) \xrightarrow{H^1(\psi)}
  H^1(\QQ, E)\]
This in turn gives us the short exact sequence
\begin{equation} \label{exact}
  0 \rightarrow \frac{E(\QQ)}{\psi(\bar{E} (\QQ))} \rightarrow
  H^1(\QQ, \ZZ / 2\ZZ) \rightarrow H^1(\QQ, \bar{E}(\QQ))[\psi] \rightarrow 0.
\end{equation}
To get the order of $E(\QQ) / \psi(\bar{E}(\QQ))$ we need to investigate the group
$H^1(\QQ, \ZZ/2\ZZ)$.

\begin{prop}
  Let $K$ be a perfect field. There exists a canonical isomorphism
  \[H^1(K, \ZZ/2\ZZ) \simeq K^{\times} / (K^{\times})^2\]
\end{prop}
\begin{proof}
Consider the exact sequence of Galois modules
\[0 \rightarrow \mu_2 \rightarrow \bar{K}^{\times} \xrightarrow[]{2} \bar{K}^{\times} \ra
  \, 0 \]
where $\mu_2$ is the multiplicative group $\{1, -1\}.$
 
Taking cohomology gives the long exact sequence
\[ 0 \ra \mu_2 \ra K^{\times} \xrightarrow[]{2} K^{\times} \ra H^1(K, \ZZ/2\ZZ)
  \ra H^1(K, \bar{K}^{\times})\]
and $H^1(K, \bar{K}^{\times}) \simeq 0$ by Hilbert's Theorem 90. Thus,
\[H^1(K, \ZZ/2\ZZ) \simeq K^{\times}/(K^{\times})^2. \qedhere\]
\end{proof}

\begin{remark}
  If the characteristic of $K$ is 2, the group $\mu_2$ is trivial, so we
  actually have $\bar{K}^\times \simeq (\bar{K}^\times)^2$, and thus $H^1(K,
  \ZZ/2\ZZ) = 0.$
\end{remark}

Applying the result to \autoref{exact}, we have $H^1(\QQ, \ZZ / 2\ZZ) \simeq
\QQ^\times / (\QQ^\times)^2$, giving the short exact sequence
\[0 \ra \frac{E(\QQ)}{\psi({\bar{E}(\QQ)})} \ra \QQ^\times / (\QQ^\times)^2 \ra
H^1(\QQ, \bar{E}(\QQ))[\psi] \ra 0,\]
which shows that $E(\QQ) / \psi(\bar{E}(\QQ))$ is a subgroup of $\QQ / (\QQ^\times)^2.$

\section{The Selmer and Tate-Shafarevich Groups}

In the effort to understand $E(\QQ)/2E(\QQ)$, we were led to consider the quotient
$E(\QQ) / \psi(\bar{E}(\QQ))$. Our application of Galois cohomology showed that this
group is a subgroup of the multiplicative group of rationals modulo squares
$\QQ^{\times} / (\QQ^{\times})^2$. This opens the possibility of employing local
methods to study $E(\QQ)/2E(\QQ)$.

\begin{defn}
  A \defin{place} $\nu$ is either a prime number $p$ or $\infty$. $\QQ_\nu$ then is
  either the field of $p$-adic numbers if $\nu = p$ or $\RR$ if $\nu = \infty$.
\end{defn}

We have a natural inclusion 
$$\QQ \hookrightarrow \prod\limits_\nu \QQ_\nu$$
given by
$$x \mapsto (x, x, \dots),$$ 
since $\QQ \hookrightarrow \QQ_{\nu}$ canonically for each
$\nu$. This gives rise to the following commutative diagram with exact rows:

\begin{tikzcd}
  0 \arrow[r] &
  E(\QQ)/\psi(\bar{E}(\QQ)) \arrow[r] \arrow[d]&
  \QQ^{\times}/(\QQ^{\times})^2 \arrow[r] \arrow[d] &
  H^1(\QQ, \bar{E})[\psi] \arrow[r] \arrow[d] &
  0 \\
  0 \arrow[r] &
  \prod\limits_{\nu} E(\QQ_\nu) / \psi(\bar{E}(\QQ_\nu)) \arrow[r] &
  \prod\limits_\nu(\QQ_\nu^{\times}/(\QQ_\nu)^{\times})^2 \arrow[r] &
  \prod\limits_\nu H^1(\QQ_\nu, \bar{E})[\psi] \arrow[r] &
  0
\end{tikzcd}

This diagram gives an interface for studying $E(\QQ)/\psi(\bar{E}(\QQ))$ via
local methods. It turns out that we can split the information required to work
out the size of $E(\QQ)/\psi(\bar{E}(\QQ))$ in two parts, given by the following
important definitions.

\begin{defn}[Selmer Group]
  The \defin{Selmer group} of the elliptic curve $E$ is defined
  $$\Sel_\psi(E) = \text{Ker}\left((\QQ^{\times}/(\QQ^{\times})^2 \ra
  \prod\limits_\nu H^1(\QQ_\nu, \bar{E})[\psi]\right)$$
\end{defn}

We can also make an analogous construction for $\Sel_\phi(E)$ by
considering the $\phi$ isogeny. 
This group is important in rank calculations primarily because it is effectively
computable. To understand $\EQ/\psi(\Eb(\QQ))$ fully, we also need

\newpage

\begin{defn}[Tate-Shafarevich Group] \label{defn:sha}
  The \defin{Tate-Shafarevich group} of the elliptic curve $E$ is defined
  $$ \Sha(E) = \text{Ker} 
  \left(H^1(\QQ, \bar{E}) \ra \prod\limits_\nu H^1 (\QQ_\nu,
  \bar{E})\right) $$
\end{defn}
Note that the isogeny $\psi: \bar{E} \ra E$ gives rise to maps $H^1(\QQ,
\bar{E}) \ra H^1(\QQ,E)$ and $H^1(\QQ_\nu, \bar{E}) \ra H^1(\QQ_\nu, E)$. It
therefore restricts to a map $\Sha(\bar{E}) \ra \Sha(E)$. We will write
$\Sha(E)[\psi]$ for the kernel of this map, and call it the
\defin{subgroup of $\psi$-torsion of $\Sha(E)$}.

Putting both groups together, we get the short exact sequence

\[ 0 \ra \frac{E(\QQ)}{\psi(\bar{E}(\QQ))} \ra \Sel_\psi(E) \ra \Sha(E)[\psi]
  \ra 0\]

If $\Sha(E)[\psi] \simeq 0$, we get
$\Sel_\psi(E) \simeq \EQ/\psi(\Eb(\QQ))$. By playing
the same game with the isogeneous curve $\Eb$, if $\Sha(E)[\phi] \simeq 0$,
we also know $\Eb(\QQ)/\phi(\EQ)$ and can use \ref{lemma:rankformula} to compute
the rank of $E$. 

For curves with a 2-torsion point, the map 
$$\alpha : \EQ / \psi(\bar{E}(\QQ)) \ra \QQ^\times / (\QQ^\times)^2$$ has been
explicitly computed in \cite[Page 91]{rational} and
is given by
$$(x,y) \mapsto x \mod (\QQ^\times)^2.$$
Furthermore, \cite[Pages 85-87]{rational} also shows that the image of $\alpha$ is
contained in the subgroup $G$ of $\QQ^\times / (\QQ^\times)^2$ given by 
\[G = \langle -1, p_1, \dots, p_k  \rangle,\]
where $p_1, \dots, p_n$ are the distinct prime factors of $\Delta(E).$

In fact, $\Sel_\psi$ is also contained in $G$, and contains the image of $\alpha$. Thus,
we know that $\Sel_\psi$ is finite, and as a consequence, we see that
$E(\QQ)/\psi(\bar{E}(\QQ))$ is also finite. If we let $$\bar{\alpha} :
\bar{E}(\QQ) / \phi (E(\QQ)) \ra \QQ^\times / (\QQ^\times)^2$$ be the map
obtained by working with $\phi$ instead of $\psi$, we get an alternative
formula for the rank $r$ of $E$ given by
\[2^r = \frac{\# \text{Im}(\alpha) \cdot \# \text{Im}(\bar{\alpha})}{4}\]

Considering the Selmer groups, we can give a computable upper bound for the rank
of $E$ from the following equation:
\[2^{s_r} = \frac{\# \Sel_\phi(E) \cdot \# \Sel_\psi(E)}{4}.\]
The positive integer $s_r$ defined by this formula 
is called the \defin{Selmer rank of $E$}, and we have $s_r \geq r.$

\newpage

\chapter{Calculations}

\section{Introduction}

From Tunnell's theorem we know that $L(E_n,1)$ has a particularly simple
form in terms of Theta functions. In this section we will show that they can be
used to predict the existence of 2-torsion in $\Sha(E_n)$. We will also compute
the arithmetic invariants of $E$ described in Chapter 2 and show that our
predictions can be verified at least modulo 16.


\section{Coefficients of Theta Series}
We recall Tunnel's theorem leads us to consider the function given by the
Fourier expansion given in \autoref{eq:mododd}:
\[
  f(z) = \sum\limits_{m=-\infty}^\infty a_m q^m
  = (\Theta(z) - \Theta(4z)) \left(\Theta(32z)-\frac{1}{2} \Theta(8z)\right) \Theta(2z).
\]


We are only interested in the coefficients for $n$ odd. In this case we can
ignore terms in the product of \autoref{eq:mododd} where all arguments of
$\Theta$ are even. Thus, it is enough to
consider the $n$-th coefficient of
\[
  \Theta(z) \left( \Theta(32z) - \frac{1}{2} \Theta(8z) \right)\Theta(2z) =
  \sum\limits_{x, y, z \in \ZZ} q^{2x^2+y^2+32z^2} - \frac{1}{2}
  \sum\limits_{x,y,z \in \ZZ} q^{2x^2+y^2+8z^2}.
\]

Here we will compute the coefficients $a_m$ and give a very simple expression for
their residues modulo 4. This will enable us to match our previous calculations
to what the BSD conjecture predicts.
To put it differently, set
\begin{equation*}
  \begin{split}
    A_n &= \#\{(x,y,z) \,|\, n = 2x^2 + y^2 + 32z^2\} \\
    B_n &= \#\{(x,y,z) \,|\, n = 2x^2 + y^2 + 8z^2\}.
  \end{split}
\end{equation*}
Then, the $n$-th coefficient of $f$ will be
\[a_n = A_n - \frac{1}{2}B_n.\]

Note that whenever we have a solution to either equation in $A_n$ or $B_n$,
if none of the variables is 0, then there are in fact 8 distinct
solutions given by $(\pm x, \pm y, \pm z)$.
In this case, they together make no contribution to $A_n$ or $B_n$ modulo 8.

Similarly, if only one of the variables is 0, say $z$, then each choice from
$(\pm x, \pm y)$ gives a distinct solution, so they make no contribution
to $A_n$ modulo 4.

\begin{lemma}
  If $n$ is an odd squarefree integer, and $n > 1$,
  then $A_n$ is congruent to 0 modulo 4.
\end{lemma}
\begin{proof}
  As we saw above, solutions with less than two variables equal to 0 make no
  contribution to $A_n$ modulo 4. We're left to consider solutions when
  either 2 or 3 of variables are are 0.

  But clearly there are none. By assumption $n$ is odd, squarefree and
  positive, so it can't be equal to $0, 2x^2, y^2, $ or $32z^2$ for
  any $x,y,z \in \ZZ$.
\end{proof}

If remains to compute $\frac{1}{2}B_n$ modulo 4. The factor of $\frac{1}{2}$
requires us to consider $B_n$ modulo 8.
An identical argument shows that there are no solutions with two or three
variables
equal to 0, so
we're left to consider solutions where only one of $x,y,z$ is 0.
We define the quatities
\[
  \begin{split}
    P_n &= \#\{(x,y) \,|\, n = x^2 + 2y^2\} \\
    Q_n &= \#\{(x,y) \,|\, n = x^2 + 8y^2\} \\
    R_n &= \#\{(x,y) \,|\, n = 2x^2 + 8y^2\}.
  \end{split}
\]
so that
\[
  B_n \equiv P_n + Q_n + R_n \mod{8}.
\]

Clearly $R_n = 0$ since $n$ is odd. We will now use some algebraic number theory
to compute $P_n$ and $Q_n$.

\begin{thm} \label{coeff_formula}
  Let $n = p_1 \cdots p_k$ where the $p_i$ are the distinct prime factors of
  $n$. We have the formulae
  \begin{enumerate}[(i)]
  \item \(P_n = 2 \times \prod\limits_{p_i \mid n} \left( 1+ \legendre{-2}{p_i}
      \right)\)

  \item \( Q_n =
      \begin{cases}
        P_n &\text{ if } n \equiv 1 \mod{8} \\
        0 &\textnormal{ otherwise.}
      \end{cases}
    \)
  \end{enumerate}
\end{thm}

\begin{proof}
  (i) In algebraic number theory parlance, working out $P_n$ is equivalent to
  counting the number of elements in $\quadring{-2}$ with norm $n$.
  Since $\quadring{-2}$ is
  a PID, we have unique factorization of elements. Thus, for
  $\alpha \in \quadring{-2},$
  \[N(\alpha) = n\]
  if and only if
  \[\alpha = \pi_1 \cdots \pi_k\]
  where the $\pi_i$ are distinct irreducibles and $N(\pi_i) =
  p_i.$ Since $\quadring{-2}$ has 2 units, by Dirichlet's unit theorem we have
  \[P_n = 2\prod\limits_{p_i \mid n} \alpha_i\]
  where $\alpha_i$ is the number of prime ideals in $\quadring{-2}$ with norm $p_i$.

  Again since $\quadring{-2}$ is a PID, we can pass from properties of prime
  ideals to properties of irreducible elments. Applying the result in
  \cite[Page 74, Theorem 25]{marcus} for each $p_i$, there are 2 cases
  to consider.

  \begin{itemize}
  \item If $\legendre{-2}{p_i} = -1$, $p_i$ is already irreducible in
    $\quadring{-2}$, and $N(p_i) = p_i^2.$ Thus, there are no elements of norm
    $p_i$, and hence none of norm $n$.

  \item If $\legendre{-2}{p_i} = 1$, $p_i$ splits, so we can write $p_i =
    \pi_i\bar{\pi_i}$ for some irreducible $\pi_i \in \quadring{-2}$ with
    $N(\pi_i) = p_i$. In this case there are 2 ideals of norm $p_i$ generated by
    $\pi_i$ and $\bar{\pi}_i$ respectively. Thus, we can write
    \[\alpha_i = \left( 1 + \legendre{-2}{p_i} \right),\]
    which gives our formula for $P_n$.
  \end{itemize}
  (ii) For the second formula, note that each $x,y \in \ZZ$ satisfying
  \[x^2 + 8y^2 = x^2 + 2\cdot(2y)^2= n\]
  corresponds to an element $x+y\sqrt{-2} \in \quadring{-2}$ with norm $n$
  and $y$ even. There are three possibilities.

  \begin{itemize}
  \item If $n \equiv 5, 7 \,(8)$, $n$ must have at least one prime factor $p_i
    \mid n$ with $p_i \not\equiv 1,3 \,(8)$. But then $\legendre{-2}{p_i} = -1$,
    so by the formula for $P_n$, there are no elements in $\quadring{-2}$ with
    norm $n$, and $Q_n$ is also 0.

  \item If $n \equiv 1 \, (8)$, assume there exists an element $x + y \sqrt{-2}$ of
    norm $n$ in $\quadring{-2}$. Note that
    \[n = x^2 + 2y^2 \equiv x^2 \mod{2},\] so $x$ must be odd. Suppose $y$ is
    also odd. Checking the squares of all odd numbers modulo 8, we see that $y^2
    \equiv 1 \,(8)$, so
    \[n = x^2 + 2y^2 \equiv 3 \mod{8},\] a contradiction. Thus $y$ must be even,
    and each solution contributing to $P_n$ also contributes to $Q_n$, so $P_n =
    Q_n$.

  \item If $n \equiv 3 \, (8)$ and $y$ is even,
    \[n = x^2 + 2y^2 \equiv 1 \mod{8},\] a contradiction. Thus, $y$ must be odd,
    and solutions contributing to $P_n$ make no contribution to $Q_n$, so $Q_n =
    0$.
  \end{itemize}
  Putting everything together gives the desired formula.

\end{proof}

\newpage

We are now ready to find an expression for $a_n$ modulo 4. 

\begin{thm} \label{theta_calculation}
  If $n = p$ is prime, the coefficient $a_p$ of $f(z)$ in \autoref{eq:mododd}
  satisfies
  \[a_p \equiv \begin{cases}
      0 \mod{4} \text{ if } p \equiv 1,5,7 \mod{8} \\
      2 \mod{4} \text{ if } p \equiv 3 \mod{8}.
    \end{cases}\]
  If $n$ has at least 2 prime factors, we have
  \[a_n \equiv 0 \mod{4}.\]
\end{thm}
\begin{proof}
  Recall that
  \[
    \begin{split}
      a_n &= A_n - \frac{1}{2}B_n \\
      &\equiv -\frac{1}{2}(P_n + Q_n) \mod{4}. \\
    \end{split}
  \]

  Note that $\left( 1 + \legendre{-2}{p} \right)$ is always even, so
  if $n$ has two or more prime factors, clearly $P_n \equiv Q_n \equiv 0 \,(8)$.
  In this case we have
  \[a_n\equiv 0 \mod{4}.\]

  If $n = p$ is an odd prime, theorem \autoref{coeff_formula} gives
  \[P_p = 2 \cdot \left( 1 + \legendre{-2}{p} \right)\]
  \begin{itemize}
  \item If $p \equiv 1 \, (8), Q_p = P_p = 2 \cdot 2 = 4$.

  \item If $p \equiv 3 \, (8), P_p = 4$ but $Q_p = 0$.

  \item If $p \equiv 5, 7 \, (8), P_p = Q_p = 0$.
  \end{itemize}
  Thus, $-\frac{1}{2} (P_p + Q_p) = 0$ unless $p \equiv 3 \, (8)$, in which case
  it equals $-2$. This gives the result.

\end{proof}


\section{Selmer Group}

Now we proceed in the other direction, and examine the expected rank of the
curve by studying its arithmetic invariants. We'll first compute the Selmer
group of $E_p$ and $\Eb_p$. Recall that in this case, the Selmer group is a
subgroup of $\QQ^\times / (\QQ^\times)^2.$ It won't be necessary to calculate
the Selmer rank of $E_n$ for composite $n$. This is because, as last section showed, in
this case we don't have any information about the coefficients of the theta
series associated with $E_n$ besides
knowing that it is a multiple of 4.

\begin{prop}
  $\Sel(E_p)$ is a subgroup of the multiplicative group
  $ \{ \pm 1, \pm p \}$, and $d_1 \in \Sel$ if and only if the equation
  \begin{equation} \label{eq:hom}
    N^2 = d_1 M^4 - \frac{p^2}{d_1}e^4
  \end{equation}
  has a solution in $\QQ_p$ for all $p$ and has a solution in $\RR.$
  Similarly, $\Sel(\Eb_p)$ is a subgroup of the multiplicative group
  $\{\pm 1, \pm 2, \pm p, \pm 2p\}$,
  consisting of elements $d_1$ at which
  \begin{equation}
    N^2 = d_1 M^4 + \frac{4p^2}{d_1}e^4 \label{eq:isohom}
  \end{equation}
  has a real and p-adic
  solution for all prime numbers.
\end{prop}

We will compute $\Sel$ by looking at the equation modulo different primes.
To do this we first state some general results. The first tells us
how to get a solution in the infinite field $\QQ_p$ from a solution in a finite
field.

\begin{prop}[Hensel's Lemma]
  Let $f \in \ZZ_p[X_1,\dots,X_m], x = (x_i) \in (\ZZ_p)^m, n, k \in \ZZ$ and
  $j$ an integer such that $0 \leq j \leq m$. Suppose that $2k < n$ and that
  \[ f(x) \equiv 0 \, (p^n) \text { and } \nu_p
    \left(\frac{\partial f}{\partial X_j} (x) \right) = k.\]
  Then there exists a zero $y$ of $f$ in $(\ZZ_p)^m$ which is congruent to $x$
  modulo $p^{n-k}$.
\end{prop}
\begin{proof}
  \cite[See][Chapter 2-2, page 14]{Serre}.
\end{proof}

The next result gives a bound on the number of solutions in $\ZZ_p$ for an equation
where all variables can be isolated.

\begin{prop} \label{prop:countsols}
  Let $a_1, \dots, a_r \in \FF_p^\times$ and assume $l_1, \dots, l_r$ all divide
  $p-1$.
  The number of solutions $N_p$ to the equation
  \[a_1x_1^{l_1} + \cdots a_rx_r^{l_r} \equiv 0 \, (p)\]
  satisfies
  \begin{equation} 
    |N_p - p^{r-1}| \leq M(p-1)p^{(r/2)-1}
  \end{equation} 
  where $M$ is the number of $r$-tuples
  of Dirichlet characters
  $\chi_1, \dots , \chi_r$
  where $\chi_i^{l_i} = \varepsilon, \chi_i \neq \varepsilon$ for
  $i = 1, \dots, r$ and $\chi_1 \chi_2 \cdots \chi_r = \varepsilon$.
\end{prop} 
\begin{proof}
  \cite[See][Chapter 8-7, page 103]{classical}.
\end{proof}

The following proposition will be useful to show existence of solutions
to polynomials of low enough degree.

\begin{prop}[Chevalley Warning Theorem]
  Let $f \in \FF_p[X_1, \dots , X_n]$ be a homogeneous polynomial
  in $n$ variables such that $\textnormal{deg}(f) \leq n$. Then $f$ has a nontrivial 0.
\end{prop}

\begin{proof}
  \cite[See][Chapter 1, page 5]{Serre}
\end{proof}

To compute the Selmer groups, we will have to consider three
kinds of primes: 2, $p$, and any odd prime $l \neq p$.

\subsection{l-adic case}

Let $l$ be an odd prime not equal to $p$.
In order to work out if equation Equations \ref{eq:hom} and \ref{eq:isohom} have
solutions in $\QQ_l$,
we will first show they always have a nontrivial solution 
in $\ZZ/l\ZZ$, and then lift this solution to $\QQ_l$ using Hensel's lemma.
In the $l$-adic case, will be simpler to show that every equation of the form
\begin{equation} \label{eq:genhom}
N^2 = aM^4 + be^4
\end{equation}
with $a,b \in \ZZ_l^\times$ has a nontrivial solution in $\QQ_l.$ This is
sufficient, since all
possible coefficients appearing in Equations \ref{eq:hom} and \ref{eq:isohom}
are units in $\ZZ_l$, as they are always divisors of $4p^2$.


\begin{lemma} \label{local_ladic}
  \autoref{eq:genhom} always has a nontrivial solution in $\FF_l$.
\end{lemma}
\begin{proof}
  We are looking at the number of solutions to
  \[ N^2 - aM^4 - be^4 \equiv 0 \, (l)\]
  where $a$ and $b$ are units in $\ZZ_l$. Thus, we may apply all results from
  the previous section. Let $N_l$ be the number of solutions to
  \autoref{eq:genhom} is $\FF_l$. There are two cases to consider.
  
  \begin{itemize}
  \item If $l \equiv 3 \, (4)$, the values taken by $x^4$ modulo $l$
    are the same as those taken
    by $x^2$, so $N_l$ is also the number of solutions to
    \[N^2 - aM^2 - be^2 \equiv 0 \, (l).\]
    But here $\text{deg}(f) = 2$ and there are 3 variables.
    Thus, by the Chevalley Warning theorem, there exists a nontrivial solution
    in $\FF_l$.

  \item If $l \equiv 1 \, (4)$, there are three nontrivial Dirichlet
    characters modulo $l$ of order dividing 4. The primitive quartic
    characters $\chi^{\pm 1}$ and the quadratic character $\chi^2$ where $\chi^2(n) =
    (\frac{n}{p})$.

    Thus, $M$ is the number of tuples $\chi^2, \chi^a, \chi^b$ with
    $a,b = \pm 1, 2$ where $\chi^2 \chi^a \chi^b = \varepsilon$. There are only
    two options, given by $a = b = 1$ and $a = b = -1$, so $M = 2$.
    Substituting this into the bound in proposition \autoref{prop:countsols} we get
    \[|N_l - l^{r-1} | \leq 2(l-1) l^{(3/2)-1}.\]
    This implies that if $|N_l-l^2| \leq l^2-2$, \autoref{eq:homcurve} will have
    a nontrivial solution in $\FF_l$. But
    \[2(l-1)l^{1/2} \leq l^2 - 2\]
    is satisfied for all $l \geq 3$.
  \end{itemize}
  
\end{proof}

\begin{thm}[Existence of l-adic Solutions]
  For $a, b \not\equiv 0 \, (l)$, there is always a triple
  $x, y, z \in \QQ_l^{\times}$ such that $x^2 = ay^4 + bz^4$.
\end{thm}
\begin{proof}
  Let $f(x,y,z) = x^2 - ay^4 - bz^4$. We know from Lemma \autoref{local_ladic}
  that $f$ has a nontrivial root $(X,Y,Z)$ in $\FF_l$. Wihtout loss of generaility,
  we may assume that $X \not\equiv 0 \, (l)$ (see Lemma \autoref{vanilla} for a
  more complicated, but essentially identical argument of why).

  Since $l$ is odd and the variables are isolated,
  none of the partial derivatives increase the $l$-adic valuation
  of $f$. For instance, $\nu_l \left( \parder{f}{x} \right)=
  \nu_l(2X) = 0$ and $f(X,Y,Z) \equiv 0 \, (l)$, so $\nu_l(f(X,Y,Z)) \geq 1$.
  Thus, Hensel's lemma applies and we get a solution $\tilde{X}, \tilde{Y}, \tilde{Z}
  \in \QQ_l$. 
\end{proof}
  
\subsection{p-adic case}
Now there are only finitely many equations to check. We will proceed case by
case. Remember we are trying to find solutions in $\QQ_p$ to the equations
\begin{equation} \label{eq:homcurve}
  N^2 = d_1 M^4 - \frac{p^2}{d_1}e^4
\end{equation}
and
\begin{equation} \label{eq:isocurve}
  N^2 = d_1 M^4 + \frac{4p^2}{d_1}e^4
\end{equation}
corresponding to the curves $E_p$ and $\Eb_p$.

\begin{thm}[Existence of p-adic solutions]
  The equations \ref{eq:homcurve} have a nontrivial solution in $\QQ_p$. In fact,
  they have solutions in $\QQ$.
\end{thm}
\begin{proof} This is easy since we can spot rational solutions in all cases.
   
  \begin{itemize}
  \item If $d_1 = -1$, we have the rational solution $(p, 0, 1)$.
  \item If $d_1 = p$, we have the rational solution $(0, 1, 1)$.
  \item If $d_1 = -p$, we have the rational solution $(0, 1, 1)$.
  \end{itemize}
\end{proof}

To work on the isogeneous curve, we need three aditional technical lemmas,
that will help us streamline our computations.

\begin{lemma} \label{vanilla}
  Let $a, b \in \ZZ_p$. Then the equation 
  \begin{equation}
    \label{eq:multvanilla}
    N^2 = aM^4 + be^4
  \end{equation}
  has a nontrivial solution in $\QQ_p$ if and only if it has a solution with
  $N, M, e \in \ZZ_p$. Furthermore, we may assume one of the variables $N, M, e$
  is a unit.
\end{lemma}

\begin{proof}
  First suppose we have a solution and write
  $$N = p^{-a}x, \,\, M = p^{-b}y, \,\, e = p^{-c}z$$ where $x,y,z \in \ZZ_p$ and
  $a,b,c \in \NN.$ We have
  \[p^{-2a}x^2 = ap^{-4b}y^4 + bp^{-4c}z^4.\]
  Multiplying by $p^{4(a+b+c)}$ gives
  \[p^{2a+4b+4c}x^2 = ap^{4a+4c}y^4 + bp^{4a+4b}z^4,\]
  so we get a new solution $(p^{a+2b+2c}x, p^{a+c}y, p^{a+b}z)$ to
  \autoref{eq:multvanilla} with all variables in $\ZZ_p$.

  Now suppose $N, M, e \in \ZZ_p$. If all of them are divisible by $p$,
  writing $N = pN', M = pM', e = pe'$ for $N', M', e'$ still in $\ZZ_p$ gives
  \[p^2N'^2 = ap^4M'^4 + b p^4e'^4, \]
  so $N \equiv 0 \, (p)$ and we in fact have $N' = pN'', N'' \in \ZZ_p.$ 
  But then,
  \[p^4N''^2 = ap^4M'^4 + bp^4e'^4.\]
  Dividing through by $p^4$ we see that $(N'',M',e')$ is a new solution to
  \autoref{eq:multvanilla} where each variable has
  strictly smaller valuation. Thus, we may assume one of $N,M,e$ is a unit.
\end{proof}

\begin{lemma} \label{multp2}
  Let $a, b \in \ZZ_p^\times$. Then the equation
  \begin{equation}
    \label{eq:multp2}
    N^2 = aM^4 + bp^2e^4
  \end{equation}
  has a nontrivial solution in $\QQ_p$ if and only if either $\legendre{a}{p} = 1$
  or $\legendre{b}{p} = 1.$
\end{lemma}
\begin{proof}
  Suppose we have a solution.
  From \autoref{vanilla}, we may assume $N, M, e \in \ZZ_p$, with one of the
  variables a unit. There are 2 cases to consider.
  \begin{itemize}
  \item If neither $N$ nor $M$ is 0 modulo $p$, we get
    \[N^2 \equiv aM^4 \mod{p^2}\]
    or
    \[a \equiv \legendre{N}{M^2}^2 \mod{p},\]
    and we must have $\legendre{a}{p} = 1$ as wanted.
  \item If one of $N$ or $M$ is 0 modulo $p$, \autoref{eq:multp2} clearly shows
    the other must also be, so we can write $N = pN'$, $M = pM'$. We get
    \[p^2N^2 = ap^4M^4 + bp^2e^4\]
    or
    \[N'^2 = ap^2M'^4 + be^4.\]
    This is just \autoref{eq:multp2} with the variables reversed. From the
    previous lemma, we may assume that $e$ is a unit, 
    so the previous case shows that we must have
    $\legendre{b}{p}=1$.
  \end{itemize}
  This concludes the only if direction of our theorem.

  Conversely, if $\legendre{a}{p} = 1$, by applying Hensel's
  lemma to the polynomial $X^2 - a$ we see that $a$ has a square root in
  $\QQ_p$. Thus, we have a solution
  to \autoref{eq:multp2} given by
  \[(\sqrt{a}, 1, 0)\]
  If $\legendre{b}{1} = 1$ we similarly have the solution
  \[(p\sqrt{b}, 0, 1).\]
  
\end{proof}

\begin{lemma} \label{multpp}
  Let $a, b \in \ZZ_p^\times$. Then the equation
  \begin{equation}
    \label{eq:multpp}
    N^2 = apM^4 + bpe^4
  \end{equation}
  has a nontrivial solution in $\QQ_p$ if and only if
  $\frac{-a}{b}$ is a 4th power in $\FF_p$.
\end{lemma}

\begin{proof}
  This is similar to the previous lemma. If we have a solution,
  lemma \autoref{vanilla} shows that we may assume $N, M, e \in \ZZ_p$ with one
  of them a unit. Clearly $p | N^2$ and hence $N$, so we may write $N = pN'$,
  giving
  \[p^2N'^2 = apM^4 + bpe^4\]
  or
  \[pN'^2 = aM^4 + be^4.\]
  If $M$ is divisble by $p$, clearly $e$ must also be. But this contradicts lemma
  \autoref{vanilla}, so we may assume $M$ and $e$ are both units.
  Thus, we must have
  \[aM^4 + be^4 \equiv 0 \mod{p}\]
  or
  \[\frac{-a}{b} \equiv \legendre{e}{M}^4 \mod{p}\]
  as wanted.

  Conversely, if $\frac{-a}{b}$ is a 4th power in $\FF_p$, we may lift it to
  $\QQ_p$ using
  Hensel's lemma on $X^4 + \frac{a}{b}$, giving the solution
  \[\left(0, 1, \legendre{-a}{b}^{1/4}\right)\]
  to \autoref{eq:multpp}.
\end{proof}

We are now ready to work with the homogeneous spaces of $\bar{E}$ in $\QQ_p$.

\begin{thm}[Existence of p-adic solutions, isogeneous curve]
  The equations \ref{eq:isocurve} have a nontrivial solution in $\QQ_p$ subject
  to the following conditions: 

  $\begin{tabu}{l*{2}{c}r}
    d_1 & \text{condition} \\
    \hline
    1 & \cmark \\
    2 & p \equiv 1, 7 \, (8) \\
    p & p \equiv 1 \, (4) \\
    2p & p \equiv 1 \, (8) \\
    -1 & p \equiv 1 \, (4) \\
    -2 & p \equiv 1, 3 \, (8) \\
    -p & p \equiv 1 \, (4) \\
    -2p & p \equiv 1 \, (8)
  \end{tabu}$

  For instance, if $d_1 = 2p$, $\ref{eq:isocurve}$ has a
  nontrivial solution in $\QQ_p$ if and only if $p \equiv 1 \, (8).$
\end{thm}
\begin{proof} Proceeding case by case:
  \begin{itemize}

   
  \item If $d_1 = 2,$ we're trying to solve
    \[N^2 = 2M^4 + 2p^2.\]
    We may apply lemma \autoref{multp2}, so we have a nontrivial solution
    iff $\legendre{2}{p} = 1.$
    
    In other words, we must have
    \[p \equiv 1 \text{ or } 7 \mod{8}.\]
      
  \item If $d_1 = p$, we're trying to solve
    \[N^2 = pM^4 + 4pe^4.\]
    This is of the same form as \autoref{eq:multpp}, so we have a nontrivial
    solution iff $-4$ is a 4th power in $\FF_p$.

    First note that if
    $p \equiv 3 \,(4),$ the values taken by $x^4$ are the same as those taken
    by $x^2$, so the condition is equivalent to $-4$ being a square.
    But $\legendre{-4}{p} = \legendre{-1}{p} = -1$ since $p \equiv 3 \, (4)$,
    a contradiction.

    If $p \equiv 1 \,(4)$, we need to solve
    \[x^4 = -4,\]
    or equivalently,
    \[x^2 = \pm 2\sqrt{-1}.\]

    There are 2 cases to consider:

    If $p \equiv 1 \, (8)$, $\legendre{2}{p} = 1.$ Furthermore,
    \cite[page 4, Theorem 3.1]{Hensel} shows that
    $\QQ_p$ contains a primitive 8th root of unit $\zeta_8$. But then, since
    $(\zeta_8^4)^2 - 1 = 0$ in the field $\QQ_p$, by primitivity we must have
    $\zeta_8^4 = -1$. Thus we may take
    \[-4 = (\zeta_8\sqrt{2})^4.\]

    If $p \equiv 5 \, (8)$, $\legendre{2}{p} = -1$ and there are no primitive
    8th roots of 1. In particular, there are no 4th roots of -1, and thus
    \[\legendre{2\sqrt{-1}}{p} = \legendre{2}{p} \cdot \legendre{\sqrt{-1}}{p} =
      (-1)\cdot(-1) = 1.\]
    In this case we can take
    \[-4 = \left(\sqrt{2\sqrt{-1}}\right)^4.\]

    Thus, we have a nontrivial solution iff
    \[p \equiv 1 \mod{4}.\]


  \item If $d_1 = 2p$, we're trying to solve
    \[N^2 = 2pM^4 + 2pe^4.\]
    Again we can apply lemma \ref{multpp}, so we have a nontrivial solution iff
    $\frac{-2}{2} = -1$ is a 4th power. By the reasoning in the previous case,
    this is true iff
    \[p \equiv 1 \mod{8}.\]

  \item If $d_1 = -1,$ we're trying to solve
    \[N^2 = -M^4 - 4p^2e^4.\]
    This is of the same form as \autoref{eq:multp2}, so we have a nontrivial
    solution iff either $\legendre{-1}{p}$ or $\legendre{-4}{p}$ is
    equal to 1.

    In other words, we must have
    \[p \equiv 1 \mod{4}.\]


  \item If $d_1 = -2$, we're trying to solve
    \[N^2 = -2M^4 - 2p^2e^4,\]
    Applying lemma \ref{multp2}, a similar argument shows
    we must have $\legendre{-2}{p}=1$,
    or equivalently,
    \[p \equiv 1,3 \mod{8}.\]

  \item If $d_1 = -p$, we're trying to solve
    \[N^2 = -pM^4 + -4pe^4.\]
    Applying lemma \ref{multpp}, we again have a nontrivial solution
    iff -4 is a 4th power. We saw before that we must then have
    \[p \equiv 1 \mod{4}.\]

  \item If $d_2 = -2p$, we're trying to solve
    \[N^2 = -2pM^4 + -2pe^4.\]
    Again applying lemma \ref{multpp}, we have a nontrivial solution
    iff -1 is a 4th power. This is the case iff
    \[p \equiv 1 \mod{8}.\]
    
  \end{itemize} \qedhere
\end{proof}

\subsection{2-adic case}

Finally, we consider the 2-adic solutions.

Note that we didn't make use of $p$ being odd in the proof of lemma
\ref{vanilla}, so we also have:

\begin{lemma}
  Let $a, b \in \ZZ_2$. Then the equation
  \[N^2 = aM^4 + be^4\]
  has a nontrival solution in $\QQ_2$ if and only if it has a solution
  with $N,M,e \in \ZZ_2$. Furthermore, we may assume one of the variables
  $N,M,e$ is a 2-adic unit.
\end{lemma}

Remember that \autoref{eq:homcurve} has
rational solutions. Since $\QQ \hookrightarrow \QQ_2$,
we only need to consider the isogeneous curve.

\begin{thm}
  The equations \ref{eq:isocurve} have a nontrivial solution in $\QQ_2$ subject
  to the following conditions:
  
  $\begin{tabu}{l*{2}{c}r}
    d_1 & \text{condition} \\
    \hline
    1 & \cmark \\
    2 & p \equiv 1, 7 \, (8) \\
    p & p \equiv 1 \, (4) \\
    2p & p \equiv 1 \, (8) \\
    -1 & \xmark \\
    -2 & \xmark \\
    -p & p \equiv 3 \, (4) \\
    -2p & p \equiv 7 \, (8)
  \end{tabu} $
\end{thm}
\begin{proof}
  We're trying to find a root for
  \[f(N,M,e) = N^2 - d_1M^2 - \frac{4p^2}{d_1}e^4\]
  in $\QQ_2,$
  where $d_1$ ranges over all divisors of $4p^2$.
  We begin with a few preliminary remarks that will help to 
  simplify our calculations.
 
  Checking all possible cases we see that
  \[x^4 \equiv
    \begin{cases}
      1 \mod{16} \text{ if } x \text{ is even} \\
      0 \mod{16} \text{ if } x \text{ if odd}
    \end{cases}.
  \]
  Thus, $M^4$ and $e^4$ may only take the values 0 or 1 modulo 16.
  Also note that the values taken by $N^2$ modulo 16 are among 0, 1, 4 and 9.
 
  We now treat each possibility for $d_1$ separately.
  
  \begin{itemize}
  \item If $d_1 = 2$, we're trying to solve
    \[N^2 = 2M^4 + 2p^2e^4 \] in $\QQ_2$. 
    Since the RHS is even, we will need
    to work modulo 32. Writing
    \[N^2 \equiv 2M^4 + 2p^2e^4 \, (32)\]
    we see that $N$ is even. Let $N = 2N'$, so we have
    \[2N'^2 \equiv M^4 + p^2e^4 \, (16).\]
    Since $p$ is odd, there are 2 possibilities.

    If $p^2 \equiv 9 \, (16),$ we see that the equation
    \[2N'^2 \equiv M^4 + 9e^4 \, (16)\]
    has no solutions by checking each possibility $M^4, e^4 = 0, 1$ and
    $N'^2 = 0, 1, 4, 9$. Thus, our original equation has no solutions modulo 32.

    If $p^2 \equiv 1 \, (16),$ the equation
    \[2N^2 \equiv M^4 + e^4 \, (16)\]
    has the solution $(1,1,1)$, so the original equation has a solution modulo
    32 given by $(2,1,1).$

    In order to apply Hensel's lemma in the variable N, note that
    $\parder{f}{N} = 2N = 4$, so we need to work modulo $4^2 \cdot 2 = 32$ as
    we already have.

    Thus, we have a nontrivial solution in $\QQ_2$ if and only if $p^2 \equiv 1
    \, (16),$ or equivalently,
    \[p \equiv 1, 7 \mod{8}.\]
    
    \item If $d_1 = p$, we're trying to solve
    \[N^2 = pM^4 + 4pe^4 \] in $\QQ_2$. Here it is sufficient to work modulo 16.
    We must have one of
    \[0, 1, 4, 9 \equiv
      \begin{cases}
        p \\
        4p \\
        5p
      \end{cases} \mod{16}.
    \]

    Thus, we will have a solution modulo 16 iff
    \[p \equiv 1,9 \, (16)\]
    or
    \[4p \equiv 4 \, (16) \implies p \equiv 1 \, (4)\]
    or
    \[5p \equiv 1, 9 \, (16) \implies p \equiv 5, 13 \, (16). \] 
    
    The second possibility brings nothing new, so we can work with only the
    first and the third. In any case we have a solution modulo 16 with $N$ and
    $M$ odd.

    To apply Hensel's lemma, note that $\parder{f}{N} = 2N$. Since $N$ is odd,
    we only need to work modulo $2^2 \cdot 2 = 8$. Thus, in each
    case the solution lifts, and we must have
    \[p \equiv 1 \mod{4}.\]
    
    \item If $d_1 = 2p$, we're trying to solve
      \[N^2 = 2pM^4 + 2pe^4 \] in $\QQ_2$. Again we must work modulo 32. By
      the same reasoning as the case $d_1 = 2$, we can instead solve
      \[2N'^2 \equiv pM^4 + pe^4 \, (16),\]
      where $N = 2N'.$ Since $p$ is odd, our only hope for a solution is
      if $2p \equiv 2 \,(16)$, or $p \equiv 1 \, (8).$ In this case, a solution
      mod 32 is $(2, 1,1).$

      To apply Hensel's lemma, note that $\parder{f}{N} = 2N = 4$, so we were
      justified in working mod 32 in the first place. Thus, we must have
      \[p \equiv 1 \mod{8}.\]
      
    \item If $d_1 = -1$, we're trying to solve
    \[N^2 = -M^4 - 4p^2e^4 \] in $\QQ_2$. 
    Working modulo 16, we must have one of
    \[0, 1, 4, 9 \equiv
      \begin{cases}
        -1 \\
        -4p^2 \\
        -1-4p^2
      \end{cases} \mod{16}.
    \]

    The first option never has a solution.

    The second takes the values
    \[-4p^2 \equiv -4\cdot 1, 4 \cdot 9 \equiv 12 \, (16),\]
    so neither it nor the third possibility give any solutions.

    Thus, in this case there are no solutions modulo 16, and hence in $\QQ_2$.


    \item If $d_1 = -2$, we're trying to solve
    \[N^2 = -2M^4 - 2p^2e^4 \] in $\QQ_2$. 
    Again we must have one of
    \[0, 1, 4, 9 \equiv
      \begin{cases}
        -2 \\
        -2p^2 \\
        -2-2p^2
      \end{cases} \mod{16}.
    \]

    The first option never has a solution

    The second takes the values
    \[-2p^2 \equiv -2\cdot 1, -2 \cdot 9 \equiv 14 \, (16), \]
    so neither it nor the third option have any solutions.

    Thus, in this case there are no 2-adic solutions.

    \item If $d_1 = -p$, we're trying to solve
      \[N^2 = -pM^4 + -4pe^4 \] in $\QQ_2$. Emulating the case $d_1 = p$, we
      can work modulo 16.
    We must have one of
    \[0, 1, 4, 9 \equiv
      \begin{cases}
        -p \\
        -4p \\
        -5p
      \end{cases} \mod{16}.
    \]

    We will have a nontrivial solution modulo 16 iff 
    \[-p \equiv 1,9 \, (16) \implies p \equiv 7, 15 \, (16)\]
    or
    \[-4p \equiv 4 \, (16) \implies p \equiv -1 \, (4)\]
    or
    \[-5p \equiv 1,9 \, (16) \implies p \equiv 3, 11 \, (16).\]

    The second possibility brings nothing new, so again we can assume $N$ and
    $M$ are odd. To apply Hensel's lemma, note that $\parder{f}{N} = 2N$, so we
    may lift a root modulo $2^2 \cdot 2 = 16$. Thus, in each case the solution
    lifts, and we must have
    \[p \equiv 3 \mod{4}.\]

    \item If $d_1 = -2p$, we're trying to solve
    \[N^2 = -2pM^4 + -2pe^4 \] in $\QQ_2$. 
    We must work modulo 32. Again we may set $N = 2N'$ and solve
    \[2N'^2 = -pM^4 - pe^4 \, (16).\]
    This time our only hope is if $-2p \equiv 2 \, (16)$, or $p \equiv -1 \, (8).$
    In this case a solution mod 32 is $(2,1,1).$

    To apply Hensel's lemma, note that $\parder{f}{N} = 2N = 4$, so we were
    justified in working mod 32. Thus, we must have
    \[p \equiv 7 \mod{8}.\]

  \end{itemize}
\end{proof}
We can now put everything together to work out the Selmer rank of $E_p$.

$$  \begin{tabu}{l*{5}{c}r}
    d_1 & \text{l-adic} & \text{p-adic} & \text{2-adic} & \RR & \Sel \\
    \hline
    1 & \cmark & \cmark & \cmark & \cmark & \cmark \\
    2 & \cmark & p \equiv 1,7 \, (8) & p \equiv 1,7 \,(8) & \cmark & p \equiv 1,7 \, (8) \\
    p & \cmark & p \equiv 1 \, (4) & p \equiv 1 \, (4) & \cmark & p \equiv 1 \, (4) \\
    2p & \cmark & p \equiv 1 \, (8) & p \equiv 1 \, (8) & \cmark & p \equiv 1 \, (8)\\
    -1 & \cmark & p \equiv 1 \, (4) & \xmark & \xmark & \xmark \\
    -2 & \cmark & p \equiv 1,3 \, (8) & \xmark & \xmark & \xmark \\
    -p & \cmark & p \equiv 1 \, (4) & p \equiv 3 \, (4) & \xmark & \xmark \\
    -2p & \cmark & p \equiv 1 \, (8) & p \equiv 7 \, (8) & \xmark & \xmark 
  \end{tabu}$$

\begin{thm}[Selmer rank of $E_p$] \label{thm:selmer}
  The Selmer rank $r$ of $E$ satisfies
  \[
    r =
    \begin{cases}
      0 \text{ if } p \equiv 3 \mod{8} \\
      1 \text{ if } p \equiv 5,7 \mod{8} \\
      2 \text{ if } p \equiv 1 \mod{8}.
    \end{cases}
  \]
\end{thm}
\begin{proof}
  Let $s_r$ be the Selmer rank, then
  \[2^{s_r} = \frac{\#\Sel_\phi(E) \cdot \#\Sel_\psi(\Eb)}{4} = \#\Sel_\psi(\Eb) =
    \begin{cases}
      1 & \text{ if } p \equiv 3 \mod{8} \\
      2 & \text{ if } p \equiv 5,7 \mod{8} \\
      4 & \text { if } p \equiv 1 \mod{8} 
    \end{cases}\]
  Comparing exponents of 2 gives the result.
\end{proof}

\section{Tamagawa Numbers} \label{tamagawa}

The final step of our calculations is to work out the Tamagawa numbers of the
curves $E_n$. Recall that
\[ c_p = \left| \frac{E(\QQ_p)}{E(\QQ_p)_0} \right|\]
where $\EQp_0$ is the preimage of the nonsingular points of the reduced curve
modulo $p$ of the map
\[ \EQp \ra \EFp.\]

We begin with a straightforward lemma.

\begin{lemma} \label{singularity_condition}
  The curve
  \[ \EFp : y^2 \equiv x^3 - n^2x \mod{p}\]
  is nonsingular unless $p \, | \, 2n$.

  If $p = 2$ the only singular point is $(1,0)$.

  If $p \, | \, n$ the only singuar point is $(0,0)$.

\end{lemma}

\begin{proof}
  Since $\OO$ may could also turn out to be singular, we consider
  the projective completion
  \[f(x,y,z) = y^2z - x^3 + n^2 xz^2.\]
  A point is singular if and only if all partial derivatives vanish.
  We have
  \begin{equation*}
    \begin{split}
      \parder{f}{x} &= -3x^2 + n^2z^2 \\
      \parder{f}{y} &= 2yz \\
      \parder{f}{z} &= y^2 + n^2x
    \end{split}
  \end{equation*}
 
  There are 3 cases to consider.
  
  \begin{itemize}
  \item If $p = 2$, working in $\FF_2$ we get
    \[\parder{f}{x} = x^2+z^2 = (x-z)^2, \,\,\,\,
      \parder {f}{y} = 0, \,\,\,\,
      \parder{f}{z} = y^2.\]
    Thus, we must have $x = z$ and $ y = 0$. Since $x, y, z$ can't be 0
    simultaneously, the only candidate is the point $(1:0:1)$, which
    is in fact in the curve, and descends to the point $(1,0)$ in the
    affine model.
    
  \item If $p \mid n$, working in $\FF_p$ we get
    \[  \parder{f}{x} = -3x^2, \,\,\,\,
        \parder{f}{y} = 2yz, \,\,\,\,
        \parder{f}{z} = y^2.
      \]
    If $y = 0$, we have $f(x,y,z) = -x^3 = 0$, so $x = 0$.
    Thus,  only $(0:0:1)$ is singular, and it descends to the point $(0,0) \in \EFp$.

  \item If $p \nmid 2n$, the equations for the partial derivatives
    require us to have either $y = 0$ or $z = 0$.
   
    If $z = 0$, we must have $-x^3 = 0$, so $y = 1$. But then $\parder{f}{z}
    \neq 0$.

    If $y = 0, \parder{f}{z} = n^2x = 0$, so $x = 0$, and $\parder{f}{x} =
    n^2z^2 = 0$ and $ z = 0$, a contradiction.

    Thus, there are no singular points on $\bar{E_n}(\FF_p)$ if $p \nmid n$. \qedhere
  \end{itemize}
\end{proof}

As an easy application, we have

\begin{cor}
  If $p \not| \,\, 2n$, the Tamagawa number $c_p = 1$.
\end{cor}

\begin{proof}
  In this case, all points are nonsingular, so $\EQp_0 = \EQp$, and
  \[c_p = \left| \{1\} \right| = 1\]
  as wanted.
\end{proof}

It now remains to consider the Tamagawa number at the primes where $E_n$ has
bad reduction. We first consider the case where $p \, | \, n$. To do this
we will give an explict parametrization for the map
\[\psi : \EQp \ra \EFp\]

Working in $\QQ_p$, if $x \equiv 0 \, (p)$ then
\[y^2 = x^3 - p^{2}b^2 x \equiv 0 \mod{p^2}, \]
where we write $n = p b$ with $p \not| \,\, b $, since $n$ is squarefree.
Thus, $y \equiv 0 \, (p)$ and $(x,y)$ reduces to the singular point.

If $x \not\in p \ZZ_p$, we can write $x = p^{-n} u$ for some $u \in
\ZZ_p^\times$ and $n \geq 0$. Then,
\[y^2 = p^{-3n}u^3 - p^{2-n}b^2u,\]
so $n$ must be even. Writing $n = 2m$ we get
\[p^{6m}y^2 = u^3 - p^{2+2m}b^2u.\]
We can't have $p^{6m}y^2 \equiv 0 \, (p)$ since then
$u \equiv 0 \, (p),$ a contradiction. Thus we can write
$y = p^{-3m}v$ for some $v \in \Zpx$. We arrive at the equation
\[v^2 = u^3 - p^{2+2m}b^2u, \text{ with } u, v \in \Zpx,\]
giving
\[v^2 \equiv b^2u^3 \mod{p}.\]
For this to have a solution, we must have $\legendre{u}{p} = 1,$
so $x$ is the reciprocal of a square in $\ZZ_p$.

Setting 
\[x = \frac{1}{r^2}, \,\, r \in \ZZ_p\]
we get
\[y^2 = \frac{1}{r^6}-{n^2}{r^2} = \frac{1-n^2r^4}{r^6}.\]

We can thus parametrise the points in $\EQp_0$ by the map
\[
    P : \ZZ_p \ra \EQp_0  \]
mapping
\begin{equation} \label{eq:p-param}
  \begin{split}
    r &\mapsto \left(\frac{1}{r^2}, \frac{\sqrt{1-n^2r^4}}{r^3}\right), 
\text{ if } r \neq 0 \\
    0 &\mapsto \OO.
  \end{split}
\end{equation}

Note that the series $\sqrt{1 -n^2r^4}$ converges $p$-adically for all $r \in
\ZZ_p$ since $n \equiv 0 \, (p)$. As we're letting $r$ range over $\ZZ_p$ the
choice of square root doesn't matter, since we may just replace $r$ with $-r$
and get the other one.

We are now ready to investigate the quotient group $\left| \frac{\EQp}{\EQp_0}
\right|$.

\begin{thm} 
  If $p \nmid n$ for $n$ odd and squarefree, the torsion points $\OO, (0,0), (n,0), (-n,0)$
  are a complete set of representatives for $\frac{\EQp}{\EQp_0}$.
\end{thm}
\begin{proof}
  From \autoref{eq:p-param} we have, for $r \in \ZZ_p$,
  $P(r) = (\frac{1}{r^2}, \frac{\sqrt{1-n^2r^4}}{r^3}) = (x,y)$.

  \textbf{Step 1:} We will compute $$S := P(r) + Q$$ for each torsion point $Q$ using
  the addition formulas from \autoref{eq:adddiff}.
   
  If $Q = \OO$: $P(r) + \OO = P(r)$.

  Now suppose the line between $P(r)$ and $Q$ is given by
  \[y = \lambda x + \nu.\]

  \begin{itemize}
    
  \item If $Q = \OO$: $S = P(r) + \OO = P(r)$, and
    \[x(S) = \frac{1}{r^2}.\]
    Since $r \in \ZZ_p$, we have in particular
    \[x(S) \not\equiv 0 \mod{p}.\]
    
  \item If $Q = (0,0)$:
  We have $\lambda = \frac{y}{x}$, so
  \begin{equation*}
    \begin{split}
      x(S)
      &= \lambda^2 - x - 0 =
      \frac{\frac{1 - n^2r^4}{r^6}}{\frac{1}{r^4}} - \frac{1}{r^2} \\
      &= -n^2r^2 = -p^2b^2r^2.
    \end{split}
  \end{equation*}
  In particular, 
  \[x(S) \equiv 0 \mod{p^2}.\]
  
\item If $Q = (n, 0)$: We have $\lambda = \frac{y}{x-n} =
  \frac{\frac{\sqrt{1-n^2r^4}}{r^3}}{\frac{1-nr^2}{r^2}}$, so
  \begin{equation*}
    \begin{split}
      x(S)
      &= \lambda^2 - x - n = 
      \frac{\frac{1 - n^2r^4}{r^6}}{\frac{(1-nr^2)^2}{r^4}} -
      \frac{1}{r^2} - n \\
      &= \frac{1-n^2r^4}{r^2(1-nr^2)^2} - \frac{1+nr^2}{r^2} \\
      &= -n + \frac{2n}{1-nr^2}
    \end{split}
  \end{equation*}
  But considering the $p$-adic power series for the quotient, we have
  \[\frac{1}{1-nr^2} = 1 - nr^2 + O(n^2) \equiv 1-nr^2 \, (p^2),\] and 
  \[-n + \frac{2n}{1-nr^2} \equiv -n + 2n - 2n^2r^2 \equiv n \, (p^2).\]
  Thus, in this case we have
  \[x(S) \equiv pb \mod{p^2}.\]

  \item If $Q = (-n, 0)$: We have $\lambda = \frac{y}{x+n}$, so
  \begin{equation*}
    \begin{split}
      x(S)
      &= \lambda^2 - x + n = 
      \frac{\frac{1 - n^2r^4}{r^6}}{\frac{(1+nr^2)^2}{r^4}} -
      \frac{1}{r^2} + p \\
      &= n - \frac{2n}{1+nr^2}
    \end{split}
  \end{equation*}
  A similar calculation shows that 
  \[x(S) \equiv -pb \mod{p^2}.\]
  \end{itemize}

  As a consequence, the 4 cosets are distinct, since the $x$ coordinates of
  $P(r) + Q$ for each $Q$ are all incongruent modulo $p^2$.

  \textbf{Step 2:} We now show that indeed those are all the possibilities for $x$ modulo $p^2$.

  Note that if $x \not\equiv 0 \, (p)$, then also $y \not\equiv 0 \, (p)$, so
  $(x,y) \neq (0,0)$ in $\EFp$ and thus $(x,y)$ is the preimage of a nonsingular
  point, and belongs to the trivial coset $\EQp_0$.

  Otherwise, if $x \equiv 0 \, (p)$,
  \[y^2 = x^3 - p^2b^2x\equiv 0 \,(p^3)\]
  so
  \[y \equiv 0 \, (p^2)\]
  and
  \[ x^3-p^2b^2x \equiv 0 \, (p^4).\]
  Letting $x = pa$ we get
  \[p^3a^3-p^3b^2a \equiv 0 \, (p^4)\]
  so finally
  \[a^3 - b^2a \equiv 0 \, (p).\]
  Since $\FF_p$ is a field, we have unique factorization and thus must have
  $a \equiv 0, \pm b \, (p)$, so
  \[x \equiv 0, bp, -bp \mod{p^2}\]
  as wanted.

  \textbf{Step 3:} The next step is to show that indeed those cosets span all of
  $\frac{\EQp}{\EQp_0}$. To do this we need to show that for each possible
  residue $x \equiv 0, bp, -bp \, (p^2)$ we can solve for $r$ to find a preimage
  in $\ZZ_p$.

  Let $S = (x,y).$ Again we proceed in cases.

  \begin{itemize}
    \item If $x \equiv 0 \, (p^2),$ we can write $x = p^2t$ for some $t \in
      \ZZ_p$. We want to show that $S$ is a member of the coset $P(r) + (0,0)$,
      i.e. that we can solve
      \[x = -p^2b^2r^2\]
      for some $r \in \ZZ_p$.
      From the equation of the curve we have
      \begin{equation*}
        \begin{split}
          y^2 &= x^3 - (pb)^2x \\
          &= x(x+pb)(x-pb) \\
          x &= \frac{y^2}{(x+pb)(x-pb)} \\
          &= \frac{-y^2}{p^2(1+tpb)(1-tpb)}
        \end{split}
      \end{equation*}
      where in the last line we substituted our hypothesis $x = p^2t.$ But
      $1 + tpb$ and $1-tpb$ are squares in $\ZZ_p$, since they are congruent to
      1 modulo $p$, $\legendre{1}{p} = 1$, and we can lift them noting that
      $\nu_p(1 \pm tpb) = 0$. Thus, 
      \[\sqrt{-x} = \frac{y}{p \sqrt{1+tpb} \sqrt{1-tpb}}, \in \QQ_p,\]
      and is in fact in $\ZZ_p$ since $x$ also is. Finally, we have the solution
      \[r = \frac{\sqrt{-x}}{pb},\]
      so indeed $S \in P(r) + (0,0).$


    \item If $x \equiv pb \, (p^2)$, we want to show that $S \in P(r) + (n,0)$.
      Writing $x = pb + tp^2$ for some $t \in \ZZ_p$, we want to find $r \in
      \ZZ_p$ such that
      \[x = -n + \frac{n}{1-nr^2} \]
      or equivalently
      \[r^2 = \frac{1}{n} \cdot \frac{x-n}{x+n}. \]
      Again using the equation of the curve,
      \[ \begin{split} r^2 &= \frac{1}{n} \cdot \frac{x (x-n)^2}{x
            (x+n)(x-n)} \\
          &= \frac{(x-n)^2x}{n y^2}. \\
        \end{split}\]
      But $x = pb + p^2t$, so
      \[ r^2 = \left(\frac{x-n}{y}\right)^2 (1+pb^{-1}t).\]
      A similar argument to the above case shows that $1+pb^{-1}t$ is
      a square in $\ZZ_p$ enabling us to solve for $r \in \ZZ_p$.
      Thus, we have $S \in P(r) + (n,0)$.

    \item If $x \equiv -pb \, (p^2)$, we want to show that $S \in P(r) +
      (-n,0)$. After writing $x = -pb + tp^2$, an entirely analogous computation
      to the previous case using the corresponding formulas gives
      \[r^2 = \left( \frac{x+n}{y} \right)^2 (1 - pb^{-1}t).\]
      Again we know $1-pb^{-1}t$ is a square in $\ZZ_p$, and can solve for
      $r$. Thus, we have $S \in P(r) + (-n,0)$.
  \end{itemize}

  Since, as we noted, the cosets are distinct, this finishes the proof of the theorem.
\end{proof}

As an immediate consequence, we have: 

\begin{thm} \label{proof:tamagawa_p}
  Let $n$ be a odd squarefree integer.
  If $p \nmid 2n $, the Tamagawa number $c_p$ of $E_n$ is 4.
\end{thm}

It remains to compute the Tamagawa number of $E_n$ at 2.
Modulo 2, the equation of the curve reduces to
\[y^2 = x^3 - x.\]
Checking manually, we get that 
\[\tilde{E}(\FF_2) = \{\OO, (0,0), (1,0)\},\]
where we remember that $(1,0)$ is the singular point
(see \autoref{singularity_condition}).

We will consider the reduction modulo 2 map
\[\pi: E(\QQ_2) \ra \tilde{E}(\FF_2).\]

Recall that
\[c_2 = \left| \frac{E(\QQ_2)}{E(\QQ_2)_0} \right|, \]
where
\[E(\QQ_2)_0 = \pi^{-1} (\tilde{E}(\FF_2)_{ns}) = \{P \in E(\QQ_2) \, | \,
  \pi(P) = \OO \text{ or } \pi(P) = (0,0)\}.\]

\begin{thm} \label{proof:tamagawa_2}
  Let $n$ be an odd squarefree integer. Then the Tamagawa number $c_2$
  of $E_n$ is 2.
\end{thm}

\begin{proof}
  The preimages of $\OO$ and $(0,0)$ are nonsingular, and hence are in the
  trivial coset.
  To prove
  our claim, we will show that the preimages of the singular point $(1,0)$ lie
  in a single different coset $\overline{(1,0)}.$

  In other words, if $P, Q \in \pi^{-1}(1,0)$, we want to show that
  \[P = Q + R, \text{ for some } R \in E(\QQ_2)_0 \]
  or equivalently, 
  \[P - Q \in E(\QQ_2)_0.\]

  It turns out that choosing $Q = (n,0)$ does the job. Note that $Q = -Q$, so me
  may show that $P+Q \in E(\QQ_2)_0$.

  Let $P = (x,y)$ and $(u,v) = P + (n,0)$. In order to get a contradiction, assume
  $(u,v) \not\in E(\QQ_2)_0$ so $\pi(u,v) = (1,0)$. Writing $(u,v) = (u:v:1)$ in
  projective coordinates for a moment, we have
  \[\pi(u:v:1) = (1:0:1)\]
  so there exists some $a \in \ZZ$ so that
  \[2^a u \in \ZZ_2^\times, \,\,\, 2^av \in 2\ZZ_2, \,\,\, 2^a1 \in \ZZ_2^\times.\]
  The last condition forces $a = 0$, so $2^au = u$ is a unit. The same argument
  also shows that $x$ must be a unit.
  
  Back to affine coordinates, let $\lambda$ be the gradient of the
  line through $(x,y), (n,0)$ and $(u,v)$.

  From the addition formulas, we have
  \[u = \lambda^2 - x - n,\]
  so $$\lambda^2 = u + x + n \equiv 1 + 1 + 1 \equiv 1 \, (2),$$ and we see that $\lambda$
  is a 2-adic unit.

  By definition, 
  \[\lambda = \frac{y}{x-n}, \]
  and plugging into the equation of the curve gives 
  \[(\lambda(x-n))^2 = y^2 = x^3 -nx = x(x+n)(x-n).\]
  Simpliflying, we get
  \[\lambda^2 = \frac{x(x+n)}{x-n}.\]
  Here $x$ and $\lambda$ are units, so $\frac{x+n}{x-n}$ must also belong to $\ZZ_2^\times$.
  To get a contradiction, we will show $x+n$ and $x-n$ have different valuations.

  If $\nu_2(x+n) = a$, writing $x+n = 2^ak, k
  \in \ZZ_2^\times$, we get
  \[x-n = 2^ak -2n = 2(2^{a-1}k - n).\]
  But $\nu_2(2^{a-1}k-n) \neq a-1$ since $n$ is odd, so
  \[\nu_2(x+n) \neq \nu_2(x-n),\]
  as wanted.

  Thus, $u$ is not a unit, and $\pi(P+(n,0)) \neq (1,0)$, which concludes our proof.
\end{proof}

\begin{cor}
  Let $n$ be odd and square free. Then
  \[\prod\limits_p c_p(E_n) = 2 \cdot 4^{\omega(n)}, \]
  where $\omega(n)$ is the number of distinct prime factors of $n$.
\end{cor}

\newpage

\chapter{Conclusion}
Having worked out all the main computable invariants
for the family $E_n$, we now match our calculations with what is predicted
by the BSD conjecture. 

Recall Tunnell's theorem (\autoref{eq:tunnell}), which in our case states that
if $n$ is odd and squarefree then
\[L(E_n,1) = \frac{\beta}{4\sqrt{n}}a_n^2,\]
where $\beta = \int_1^\infty \frac{dx}{\sqrt{x^3-x}}$ and the integers $a_n$
are the coefficients of the theta series described in \autoref{eq:tunnell}.

We know that the size of the torsion group of $E_n$ is 
\begin{equation*}
    \#\Tors(E_n) = 4,
  \end{equation*}
  (see Proposition \autoref{proof:torsion}).
  The real period of $E_n$ is given by {}
\begin{equation*}
  \Omega_{E_n} = \frac{2\beta}{\sqrt{n}} 
\end{equation*}
(see Definition \autoref{proof:real_period}) and the Tamagawa numbers of $E_n$ are
\begin{equation*}
  \begin{split}
    c_2(E_n) &= 2 \\
    c_p(E_n) &= 4 \text{ if } p \mid n \\
    c_l(E_n) &= 1 \text{ if } l \neq p. \\
  \end{split}
\end{equation*}
(see Theorems \autoref{proof:tamagawa_p} and \autoref{proof:tamagawa_2}).

Substituting the data into the BSD conjecture (\autoref{eq:bsd}), we get the prediction
\[
  L(E_n,s) = C(s-1)^r + O((s-1)^{r+1})
\]
where
\begin{equation*}
  \begin{split}
    C &=
    \frac{\# \Sha(E_n) R_{E_n} \Omega_{E_n}}{\# \Tors(E_n)^2}
    \prod\limits_p c_p \\
    &= \frac{\# \Sha(E_n) R_{E_n} \beta}{4} \cdot 4^{\omega(a)}.
  \end{split}
\end{equation*}

Putting both expressions for $L(E_n, 1)$ together, the Birch Swinnerton-Dyer conjecture
predicts that 
\begin{equation} \label{mainpred} 
  a_n^2 = \#\Sha(E_n) \cdot R_{E_n}\cdot 4^{\omega(n)} \cdot 0^r.
\end{equation}
where $\omega(n)$ is the number of prime factors of $n$.

If $n$ has at least 2 prime factors, we computed (see Theorem \autoref{theta_calculation})
\[a_n \equiv 0 \mod{4},\]
so \autoref{mainpred} predicts that
\[0 \equiv 0 \mod{16},\]
which is true, but a bit uninsteresting.

If $n = p$ is an odd prime, we have found (see Theorem \autoref{theta_calculation})
\[a_p \equiv \begin{cases}
    0 \mod{4} \quad \text{ if } p \equiv 1,5,7 \mod{8} \\
    2 \mod{4} \quad \text{ if } p \equiv 3 \mod{8}
  \end{cases}
\]
so that
\[a_p^2 \equiv
  \begin{cases}
    0 \mod{16} \quad \text{ if } p \equiv 1,5,7 \mod{8} \\
    4 \mod {32} \quad \text{ if } p \equiv 3 \mod{8},
  \end{cases}
\]
since the squares of all numbers congruent to 2 modulo 4 are congruent to 4
modulo 32.

We also found (see Theorem \autoref{thm:selmer}) that the Selmer rank $s_r$ of
$E_p$ satisfies
\begin{equation*}
  s_r =
  \begin{cases}
    0 \text{ if } p \equiv 3 \mod{8} \\
    1 \text{ if } p \equiv 5,7 \mod{8} \\
    2 \text{ if } p \equiv 1 \mod{8}.
  \end{cases}
\end{equation*}

In order to achieve the strongest possible results, we will need to refer to one
last tool, which gives some structure to the Tate-Shafarevich group.
\begin{prop}
  Let $E(\QQ)$ be an elliptic curve. There exists an alternating bilinear
  pairing
  \[\langle \cdot \rangle : \Sha(E) \times \Sha(E) \ra \QQ / \ZZ.\]
  The kernel of $\langle \cdot \rangle$ is given by 
  \[K = \{ x \in \Sha(E) \, | \, \textnormal{ for all positive integers } n, 
    \exists y \in \Sha(E) \textnormal{ such that } x = ny\}.\]
  In particular, if $\Sha(E)$ is finite, then its order is a perfect square. 
\end{prop}

\begin{proof}
  \cite[See][]{Cassels}.
\end{proof}

\begin{conj} \label{cassels_conj}
  We have $K = 0$, where $K$ is the set of divisible elmeents of $\Sha(E)$,
  defined in the previous proposition.
\end{conj}

This conjecture is known to be true when the rank is 0, which will be enough for
our purposes.

The calculations in this project have allowed us to formulate and prove the
following two predictions.

\newpage

\begin{thm} \label{mainthm2}
  If $p \not\equiv 3 \, (8)$, \autoref{mainpred} is valid modulo 8. If
  Conjecture \autoref{cassels_conj} is true, then it also holds modulo 16.
\end{thm}
\begin{proof}
  If $p \not\equiv 3 \, (8),$ the coefficient $a_p$ is 0 modulo 4.
  Thus,
  the BSD conjecture predicts that
  \begin{equation} \label{pred_mod}
    4 \cdot \#\Sha(E_p) \cdot R_{E_p} \cdot 0^r \equiv 0 \mod{16}.
  \end{equation}

  \begin{itemize}
  \item We will first show that \autoref{pred_mod} is true modulo 8. This is
    equivalent to showing that
    \[\# \Sha(E_p) \cdot R_{E_p} \cdot 0^r \equiv 0 \mod{2}.\] 
    If the rank
    is nonzero, this is trivially satisfied, since the left hand side is then
    precisely 0. If $r = 0$, $R_{E_p} = 1$, so we expect
    \[\# \Sha(E_p) \equiv 0 \mod{2}.\]
    
    If $\Sha(E_p)$ is infinite, we will take this statement to mean that $\Sha(E_p)$
    contains a point of 2-torsion.
      
    For the case where $p \not\equiv 3 \, (8)$ and the rank is 0, no equations from
    \ref{eq:isocurve} besides the trivial one (with $d_1 = 1$) have rational
    solutions. Thus, we have
    \[\# \Sha(\bar{E}_p)[\psi] = \# \Sel(\bar{E}_p)[\psi] =
      \begin{cases}
        2 &\text{if } p \equiv 5,7 \mod{8} \\
        4 &\text{if } p \equiv 1 \mod{8}.
      \end{cases}
    \]
    and
    \[\# \Sha(E_p)[\phi] = \# \Sha(E_p)[\phi] = 1\] Recall that the construction
    of the $\phi$ and $\psi$ isogenies gives us a sequence of homomorphisms
    \[\Sha(E_p) \xrightarrow{\phi} \Sha(\bar{E}_p) \xrightarrow{\psi}
      \Sha(E_p)\] with $\psi \circ \phi (P) = 2P.$ Since $\Sha(E_p)[\phi] = 0$,
    we must have $\Sha(E_p)[2] = \Sha(\bar{E}_p)[\psi]$, so
    \[\# \Sha(E_p)[2] = 2 \text { or } 4 > 0.\]
    Thus, $\Sha(E_p)$ contains an element of 2-torsion, as wanted.

  \item In order to prove \autoref{pred_mod}, we must have
    \[\# \Sha(E_p) \equiv 0 \mod{4}.\]
    We will show that, assuming Conjecture \autoref{cassels_conj}, 
    that $\Sha(E_p)$ has in fact at least 4 elements of 2-torsion. 

    Let $x \in \Sha(E_p)$ be the element of 2-torsion found above. Assuming the
    conjecture, we can find some $y \in \Sha(E_p)$ such that $\langle x,y \rangle \neq 0$
    (since the kernel of $\langle \cdot \rangle$ is then equal to 0). But then
    \[2 \langle x,y \rangle = \langle 2x,y \rangle = \langle 0, y \rangle = 0,\]
    so $\langle x,y \rangle = \frac{1}{2}.$
    
    Suppose $y$ has order $n$ in $\Sha(E_p).$ Then
    \[0 = \langle x,ny \rangle = n \langle x,y \rangle = \frac{n}{2},\]
    so $\frac{n}{2} \in \ZZ$, and $n$ is even. Write $n = 2^a k$ for $k$ odd,
    and let $z = ky$. Then
    \[\langle x,z \rangle = \frac{k}{2} \equiv \frac{1}{2},\]
    so in particular $z \neq x$. But $z$ has order $2^a$, so it is contained in
    the 2-Sylow subgroup of $\Sha(E_p)$, and thus $\# \Sha(E_p)$ is a multiple
    of 4, as wanted.

  \end{itemize}
\end{proof}

\begin{thm} \label{mainthm1}
  If $p \equiv 3 \, (8)$, the BSD conjecture predicts
  that the rank of $E_p$ is 0, and this is indeed true. If furthermore $\Sha(E_p)$ is
  finite, then \autoref{mainpred} holds modulo 32.
\end{thm}

\begin{proof}
  If $p \equiv 3 \, (8)$, we have $a_p^2 \equiv 4 \, (32)$, 
  so the BSD conjecture predicts that
  \[\# \Sha(E_p) \cdot R_{E_p} \cdot 0^r \equiv 4 \mod{32}.\]
  In particular, the right hand side is not 0, so we must have $r = 0$. This
  agrees with the calculations of the Selmer rank, where we've seen that in this
  case $s_r = 0$, and we always have $s_r \geq r.$ In this case, the regulator
  $R_{E_p} = 1$, so the prediction is equivalent to
  \[\# \Sha(E_p) \equiv 1 \mod{8}.\] 

  In this case we have $\Sha(E_p)[\phi] = \Sha(\bar{E}_p)[\psi] = 0$, so
  $\Sha(E_p)[2] = 0.$ By Sylow's theorem, this means that in $\Sha$ is finite,
  it must have odd order. But then the Cassels pairing is perfect, so the order
  of $\Sha(E_p)$ is a square, and hence congruent to 1 modulo 8. This finishes
  the proof.
\end{proof}

The takeaway is that if we assume $\Sha(E_n)$ is finite, we have proved that
\autoref{mainpred} holds either modulo 16 if $n \not\equiv 3 \, (8)$, or modulo 32
if $n \equiv 3 \, (8)$. If $\Sha(E_n)$ is \textit{not} finite, we can still
interpret our result as saying that \autoref{mainpred} holds modulo 8 for all $n$.

\nocite{*}
\printbibliography[heading=bibintoc]

\end{document}

